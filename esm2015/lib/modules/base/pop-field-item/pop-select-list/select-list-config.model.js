import { FormControl } from '@angular/forms';
import { IsArray, IsDefined, IsUndefined } from '../../../../pop-common-utility';
export class SelectListConfig {
    constructor(params) {
        this.allLabel = 'All';
        this.allowAll = true;
        this.allowGroupAll = true;
        this.allOverlay = false;
        this.allOverlayEnabled = false;
        this.allOverlayLabel = '';
        this.allOverlayMessage = '';
        this.all = false;
        this.bubble = false;
        this.checkboxPosition = 'before';
        this.collapsed = false;
        this.column = 'column';
        this.displayErrors = true;
        this.defaultHeight = null;
        this.disabledIds = [];
        this.facade = false;
        this.filter = true;
        this.helpText = '';
        this.height = null;
        this.levelGap = 35;
        this.label = '';
        this.multiple = false;
        this.minHeight = null;
        this.noInitialValue = false;
        this.outline = true;
        this.patchGroupFk = false;
        this.strVal = '';
        this.setDefaultValues();
        if (params)
            for (const i in params)
                this[i] = params[i];
        const mode = this.mode;
        const hasMode = IsArray(this.mode, true) ? true : false;
        this.defaultMode = hasMode ? this.mode[0].value : 0;
        this.value = Array.isArray(this.value) ? this.value : [];
        if (this.options.values.length > 1) {
            if (this.sort) {
                if (typeof this.options.values[0].sort_order !== 'undefined') {
                    this.options.values.sort((a, b) => {
                        if (a.sort_order < b.sort_order)
                            return -1;
                        if (a.sort_order > b.sort_order)
                            return 1;
                        return 0;
                    });
                }
                else {
                    this.options.values.sort((a, b) => {
                        if (a.name < b.name)
                            return -1;
                        if (a.name > b.name)
                            return 1;
                        return 0;
                    });
                }
            }
            if (this.options.values[0].group) {
                this.groups = this.getOptionGroups();
            }
            else if (this.options.values.length) {
                let str = [];
                this.selectedOptions = [];
                this.options.values.map((option) => {
                    if (hasMode && IsUndefined(option.mode))
                        option.mode = this.defaultMode;
                    option.selected = this.value.includes(option.value) ? true : false;
                    if (option.selected) {
                        this.selectedOptions.push(option.value);
                        str.push(option.name);
                    }
                    option.indentation = (+this.levelGap) * (option.level + 1);
                    str = str.sort();
                    this.strVal = str.join(', ');
                });
                if (this.options.empty)
                    this.options.values.unshift({ value: this.options.empty.value, name: this.options.empty.name });
                const defaultGroup = {
                    label: '',
                    options: this.options,
                    open: true
                };
                this.groups = [defaultGroup];
            }
            else {
                this.groups = [];
            }
        }
        if (!this.groups)
            this.groups = [];
        if (!this.levelGap)
            this.levelGap = 35;
        this.defaultHeight = this.height;
        let allGroupsSelected = true;
        const selected = this.selectedOptions;
        let groupSelected;
        if (this.all) {
            this.selectedOptions = [];
            this.groups.map((group) => {
                group.all = true;
                this.selectedOptions = group.options.values.map((option) => {
                    option.selected = true;
                    this.selectedOptions.push(option.value);
                });
            });
            this.strVal = this.allLabel;
        }
        else {
            let str = [];
            this.selectedOptions = [];
            const isGroups = this.groups.length > 1;
            this.groups.map((group) => {
                if (group.all) {
                    if (isGroups) {
                        str.push(group.label + ' (All)');
                    }
                    else {
                        str.push('All');
                    }
                    group.options.values.filter(option => {
                        this.selectedOptions.push(option.value);
                    });
                }
                else {
                    groupSelected = group.options.values.filter((option) => {
                        return option.selected;
                    });
                    if (groupSelected && groupSelected.length) {
                        if (groupSelected.length === group.options.values.length)
                            group.all = true;
                        if (group.all) {
                            if (isGroups) {
                                str.push(group.label + ' (All)');
                            }
                            else {
                                str.push('All');
                            }
                            group.options.values.filter(option => {
                                this.selectedOptions.push(option.value);
                            });
                        }
                        else {
                            allGroupsSelected = false;
                            if (isGroups && groupSelected.length) {
                                str.push(group.label + ` (${groupSelected.length} of ${group.options.values.length})`);
                                groupSelected.map((option) => {
                                    this.selectedOptions.push(option.value);
                                });
                            }
                            else {
                                groupSelected.map((option) => {
                                    this.selectedOptions.push(option.value);
                                    str.push(option.name);
                                });
                            }
                        }
                    }
                    else {
                        group.all = false;
                        allGroupsSelected = false;
                    }
                }
            });
            if (!this.selectedOptions.length) {
                allGroupsSelected = false;
                if (this.emptyLabel) {
                    str = [this.emptyLabel];
                }
            }
            else if (!this.all && allGroupsSelected) {
                str = ['All'];
            }
            this.all = allGroupsSelected;
            str = str.sort();
            this.strVal = str.join(', ');
        }
        delete this.options;
        delete this.value;
        if (!this.patch)
            this.patch = { field: '', duration: 750, path: '', disabled: false };
        if (this.patch.displayIndicator !== false)
            this.patch.displayIndicator = true;
        if (this.groups.length === 1)
            this.collapsed = false;
        if (this.noInitialValue)
            this.value = this.multiple ? [] : '';
        if (!this.control)
            this.setControl();
        if (!(IsDefined(this.value, false)))
            this.value = this.multiple ? [] : '';
        if (this.allOverlay && !this.allOverlayLabel) {
            this.allOverlayLabel = 'All Access';
        }
    }
    setControl() {
        this.control = (this.disabled ? new FormControl({
            value: this.value,
            disabled: false
        }) : new FormControl(this.value, (this.validators ? this.validators : [])));
    }
    setDefaultValues() {
        // this.helpText = '';
        this.label = '';
        this.message = '';
        this.options = { values: [] };
        this.disabled = false;
        this.sort = false;
        // this.showTooltip = false;
        // this.tooltip = '';
    }
    getOptionGroups() {
        this.selectedOptions = [];
        const groups = {};
        const list = [];
        let defaultGroup = this.options.values[0].group;
        let defaultGroupFk = this.options.values[0].groupFk;
        this.options.values.map((option, index) => {
            if (typeof option.level === 'undefined')
                option.level = 0;
            if (this.mode && IsUndefined(option.mode))
                option.mode = this.defaultMode;
            option.indentation = (+this.levelGap) * (option.level + 1);
            if (!option.group)
                option.group = defaultGroup;
            if (option.group in groups === false) {
                groups[option.group] = {
                    label: option.group,
                    options: { values: [] },
                    all: false,
                    indeterminate: false,
                    open: true,
                    groupFk: option.groupFk,
                };
                defaultGroup = option.group;
                defaultGroupFk = option.groupFk;
            }
            option.selected = this.value.includes(option.value);
            if (option.selected) {
                this.selectedOptions.push(option.value);
            }
            groups[option.group].options.values.push(option);
        });
        const count = Object.keys(groups).length;
        Object.keys(groups).map((key) => {
            let indeterminate = false;
            let all = true;
            groups[key].options.values.some(option => {
                if (!option.selected) {
                    all = false;
                    indeterminate = true;
                    return true;
                }
            });
            groups[key].all = all;
            groups[key].indeterminate = indeterminate;
            if (count > 1 && this.collapsed)
                groups[key].open = false;
            list.push(groups[key]);
        });
        const countLabel = this.selectedOptions.length > 1 ? `[${this.selectedOptions.length}] ` : '';
        return list;
    }
    resetSelection() {
        this.selectedOptions = [];
    }
    addSelectedOption(option) {
        this.selectedOptions.push(option);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWxpc3QtY29uZmlnLm1vZGVsLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvcG9wLWNvbW1vbi9zcmMvbGliL21vZHVsZXMvYmFzZS9wb3AtZmllbGQtaXRlbS9wb3Atc2VsZWN0LWxpc3Qvc2VsZWN0LWxpc3QtY29uZmlnLm1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQWUsTUFBTSxnQkFBZ0IsQ0FBQztBQUkxRCxPQUFPLEVBQThCLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sZ0NBQWdDLENBQUM7QUE2RDdHLE1BQU0sT0FBTyxnQkFBZ0I7SUEyRDNCLFlBQWEsTUFBa0M7UUF6RC9DLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsYUFBUSxHQUFHLElBQUksQ0FBQztRQUNoQixrQkFBYSxHQUFJLElBQUksQ0FBQztRQUN0QixlQUFVLEdBQUksS0FBSyxDQUFDO1FBQ3BCLHNCQUFpQixHQUFJLEtBQUssQ0FBQztRQUMzQixvQkFBZSxHQUFJLEVBQUUsQ0FBQztRQUN0QixzQkFBaUIsR0FBSSxFQUFFLENBQUM7UUFFeEIsUUFBRyxHQUFHLEtBQUssQ0FBQztRQUNaLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFDZixxQkFBZ0IsR0FBRyxRQUFRLENBQUM7UUFDNUIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUVsQixXQUFNLEdBQUcsUUFBUSxDQUFDO1FBQ2xCLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBRXJCLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBR3JCLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBSWpCLFdBQU0sR0FBRyxLQUFLLENBQUM7UUFDZixXQUFNLEdBQUcsSUFBSSxDQUFDO1FBR2QsYUFBUSxHQUFHLEVBQUUsQ0FBQztRQUNkLFdBQU0sR0FBRyxJQUFJLENBQUM7UUFFZCxhQUFRLEdBQUcsRUFBRSxDQUFD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Q0osTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQyxlQUFlLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUU5RixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFHTSxjQUFjO1FBQ25CLElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO0lBQzVCLENBQUM7SUFHTSxpQkFBaUIsQ0FBRSxNQUFjO1FBQ3RDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFFLE1BQU0sQ0FBRSxDQUFDO0lBQ3RDLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZvcm1Db250cm9sLCBWYWxpZGF0b3JGbiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IFNlbGVjdEZpbHRlckdyb3VwSW50ZXJmYWNlIH0gZnJvbSAnLi4vcG9wLXNlbGVjdC1maWx0ZXIvc2VsZWN0LWZpbHRlci1jb25maWcubW9kZWwnO1xuaW1wb3J0IHsgRXZlbnRDYWxsYmFjaywgRmllbGRJdGVtT3B0aW9uLCBGaWVsZEl0ZW1PcHRpb25zLCBGaWVsZEl0ZW1QYXRjaEludGVyZmFjZSB9IGZyb20gJy4uLy4uLy4uLy4uL3BvcC1jb21tb24ubW9kZWwnO1xuaW1wb3J0IHsgU2V0Q29udHJvbCB9IGZyb20gJy4uLy4uLy4uLy4uL3BvcC1jb21tb24tZG9tLm1vZGVscyc7XG5pbXBvcnQgeyBBcnJheUtleUJ5LCBBcnJheU1hcFNldHRlciwgSXNBcnJheSwgSXNEZWZpbmVkLCBJc1VuZGVmaW5lZCB9IGZyb20gJy4uLy4uLy4uLy4uL3BvcC1jb21tb24tdXRpbGl0eSc7XG5cblxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RMaXN0R3JvdXBJbnRlcmZhY2Uge1xuICBsYWJlbDogc3RyaW5nOyAgICAgICAgICAgICAgICAgICAvLyBJbnB1dCBsYWJlbC5cbiAgb3B0aW9uczogRmllbGRJdGVtT3B0aW9uczsgICAgICAgICAgLy8gQXJyYXkgb2YgRmllbGRPcHRpb25zXG4gIGFsbD86IGJvb2xlYW47XG4gIGluZGV0ZXJtaW5hdGU/OiBib29sZWFuO1xuICBncm91cEZrPzogbnVtYmVyIHwgc3RyaW5nO1xuICB2aXNpYmxlPzogbnVtYmVyOyAvLyB0aGUgY291bnQgb2YgIHZpc2libGUgb3B0aW9ucyB3aXRoaW4gdGhlIGdyb3VwXG4gIHNlbGVjdGVkPzogbnVtYmVyOyAvLyB0aGUgY291bnQgb2Ygc2VsZWN0ZWQgdmlzaWJsZSBvcHRpb25zIHdpdGhpbiB0aGUgZ3JvdXBcbiAgb3Blbj86IGJvb2xlYW47XG59XG5cblxuZXhwb3J0IGludGVyZmFjZSBTZWxlY3RMaXN0Q29uZmlnSW50ZXJmYWNlIHtcbiAgYWxsPzogYm9vbGVhbjsgICAgICAgICAgICAgICAgICAgIC8vIFNldCBib29sZWFuIHRvIGluZGljYXRlIHRoYXQgYWxsIG9wdGlvbnMgYXJlIHNlbGVjdGVkXG4gIGFsbExhYmVsPzogc3RyaW5nOyAgICAgICAgICAgICAgICAvLyBTZXQgc3RyaW5nIHRvIGFzIGxhYmVsIHRvIGluZGljYXRlIHRoYXQgYWxsIG9wdGlvbnMgYXJlIHNlbGVjdGVkXG4gIGFsbG93QWxsPzogYm9vbGVhbjsgICAgICAgICAgICAgICAvLyBTZXQgYm9vbGVhbiB0byBpbmRpY2F0ZSB3aGV0aGVyIHRvIHNldCBjaGVjayBhbGwgb3B0aW9uXG4gIGFsbG93R3JvdXBBbGw/OiBib29sZWFuOyAgICAgICAgICAgICAgIC8vIFNldCBib29sZWFuIHRvIGluZGljYXRlIHdoZXRoZXIgdG8gc2V0IGNoZWNrIGFsbCBvcHRpb25cbiAgYWxsVmFsdWU/OiBib29sZWFuIHwgc3RyaW5nIHwgbnVtYmVyIHwgbnVsbCB8IGFueVtdOyAgICAgICAvLyBBIGN1c3RvbSB2YWx1ZSBmb3Igd2hlbiBhbGwgb3B0aW9ucyBhcmUgc2VsZWN0ZWRcbiAgYWxsT3ZlcmxheT86IGJvb2xlYW47XG4gIGFsbE92ZXJsYXlFbmFibGVkPzogYm9vbGVhbjtcbiAgYWxsT3ZlcmxheUxhYmVsPzogc3RyaW5nO1xuICBhbGxPdmVybGF5TWVzc2FnZT86IHN0cmluZztcbiAgYWxsT3ZlcmxheUNhbGxiYWNrPzogRXZlbnRDYWxsYmFjaztcbiAgYnViYmxlPzogYm9vbGVhbjsgICAgICAgICAgICAgICAgIC8vIGZpcmUgZXZlbnRzXG4gIGNoZWNrYm94UG9zaXRpb24/OiBzdHJpbmc7ICAgICAgIC8vIFRoZSBwb3NpdGlvbiBvZiB0aGUgY2hlY2tib3ggZm9yIGEgbXVsdGlwbGUgc2VsZWN0aW9uLlxuICBjb250cm9sPzogRm9ybUNvbnRyb2w7ICAgICAgICAgICAgLy8gVGhlIGZvcm0gY29udHJvbC4gSWYgbm90IHBhc3NlZCBvbmUgd2lsbCBiZSBjcmVhdGVkLlxuICBjb2xsYXBzZWQ/OiBib29sZWFuOyAgICAgICAgICAgICAgLy8gU2V0IHRvIHRydWUgb24gbWFzc2l2ZSBzZXRzIHRvIHNob3cgb25seSBvcHRpb24gaGVhZGVycyBvbiByZW5kZXJcbiAgZGlzYWJsZWRJZHM/OiBudW1iZXJbXTtcbiAgZGlzYWJsZWQ/OiBib29sZWFuOyAgICAgICAgICAgICAgIC8vIE1hcmsgYXMgcmVhZG9ubHkuXG4gIGRpc3BsYXlFcnJvcnM/OiBib29sZWFuOyAgICAgICAgICAvLyBJZiBFcnJvciBtZXNzYWdlcyBzaG91bGQgYmUgZGlzcGxheWVkLlxuICBlbXB0eVZhbHVlPzogYm9vbGVhbiB8IHN0cmluZyB8IG51bWJlciB8IG51bGwgfCBhbnlbXTsgICAgIC8vIEEgY3VzdG9tIHZhbHVlIGZvciB3aGVuIGFsbCBvcHRpb25zIGFyZSB1bnNlbGVjdGVkXG4gIGVtcHR5PzogJ0NvbnZlcnRFbXB0eVRvTnVsbCcgfCAnQ29udmVydEVtcHR5VG9aZXJvJztcbiAgZW1wdHlMYWJlbD86IHN0cmluZzsgICAgICAgICAgICAgIC8vIFNldCBzdHJpbmcgYXMgbGFiZWwgdG8gd2hlbiBubyBvcHRpb25zIGFyZSBzZWxlY3RlZFxuICBmYWNhZGU/OiBib29sZWFuOyAgICAgICAgICAgICAgICAgLy8gU2V0cyBhIGZsYWcgdGhhdCBzYXlzIHRoaXMgZmllbGRJdGVtcyByZWFsbHkgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGJhY2tlbmQsIGFuZCBqdXN0IHByZXRlbmQgdG8gaGl0IHRoZSBhcGlcbiAgZmlsdGVyPzogYm9vbGVhbjsgICAgICAgICAgICAgICAgIC8vIFNlYXJjaCBmaWx0ZXIuXG4gIGhlbHBUZXh0Pzogc3RyaW5nOyAgICAgICAgICAgICAvLyBPbiBob3ZlciBoZWxwZXIgdGV4dC5cbiAgaGVpZ2h0PzogbnVtYmVyOyAgICAgICAgICAgICAgICAgIC8vIExpc3QgaGVpZ2h0LlxuICBpZD86IG51bWJlciB8IHN0cmluZzsgICAgICAgICAgICAgLy8gQSBudW1iZXIgdGhhdCB3aWxsIGJlIGluY2x1ZGVkIGluIHRoZSBldmVudHMgc28geW91IGtub3cgd2hpY2ggZmllbGQgaXQgY2FtZSBmcm9tLlxuICBsYWJlbD86IHN0cmluZzsgICAgICAgICAgICAgICAgICAgLy8gSW5wdXQgbGFiZWwuXG4gIGxldmVsR2FwPzogbnVtYmVyO1xuICBtb2RlPzogRmllbGRJdGVtT3B0aW9uW107XG4gIG1pbkhlaWdodD86IG51bWJlcjsgICAgICAgICAgICAgICAgICAvLyBMaXN0IGhlaWdodC5cbiAgbXVsdGlwbGU/OiBib29sZWFuOyAgICAgICAgICAgICAgIC8vIElmIG11bHRpcGxlIGlzIG5lZWRlZC5cbiAgbm9Jbml0aWFsVmFsdWU/OiBib29sZWFuOyAgICAgICAgICAvLyBTZXQgdG8gdHJ1ZSB0byBhbHdheXMgaGF2ZSBhbiBlbXB0eSB2YWx1ZSBvbiBsb2FkXG4gIG5hbWU/OiBzdHJpbmc7ICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZW50aXR5SWQgZmllbGQgbmFtZVxuICBvcHRpb25zPzogRmllbGRJdGVtT3B0aW9uczsgICAgICAgICAgLy8gQXJyYXkgb2YgRmllbGRPcHRpb25zXG4gIG91dGxpbmU/OiBib29sZWFuOyAgICAgICAgICAgICAgICAvLyBTaG93IGJvcmRlciBhcm91bmQgb3B0aW9uIGNvbnRhaW5lclxuICBwYXRjaD86IEZpZWxkSXRlbVBhdGNoSW50ZXJmYWNlOyAgICAgICAgICAgLy8gSWYgZmllbGQgc2hvdWxkIGJlIGF1dG8tcGF0Y2hlZC5cbiAgcGF0Y2hHcm91cEZrPzogYm9vbGVhbjsgICAgICAgICAgIC8vIElmIHZhbHVlIHNob3VsZCBjb250YWluIGdyb3VwRmssIDM6MTIsNDoxMiw1OjEzIDx2YWx1ZTpncm91cEZrPlxuICByZXF1aXJlZD86IGJvb2xlYW47ICAgICAgICAgICAgICAgIC8vIElmIGZpZWxkIHZhbHVlIGNoYW5nZSBzaG91bGQgYmUgc3RvcmVkIHRvIGNvcmUgZW50aXR5XG4gIHNlc3Npb24/OiBib29sZWFuOyAgICAgICAgICAgICAgICAvLyBJZiBmaWVsZCB2YWx1ZSBjaGFuZ2Ugc2hvdWxkIGJlIHN0b3JlZCB0byBjb3JlIGVudGl0eVxuICBzZXNzaW9uUGF0aD86IHN0cmluZzsgICAgICAgICAgICAgICAgLy8gSWYgc2Vzc2lvbiBwYXRoIGlmIG5vdCBzdG9yZWQgb24gcm9vdCBlbnRpdHlcbiAgc29ydD86IGJvb2xlYW47ICAgICAgICAgICAgICAgICAgIC8vICBTZXQgdG8gdHJ1ZSBpZiB5b3Ugd2FudCBvcHRpb25zIHRvIGJlIHNvcnRlZCBpbiBwcmlvcml0eSBvZiBzb3J0X29yZGVyLCBuYW1lXG4gIHZhbHVlPzogQXJyYXk8bnVtYmVyIHwgc3RyaW5nPiB8IG51bWJlciB8IHN0cmluZzsgIC8vIEluaXRpYWwgdmFsdWUuXG4gIHZhbGlkYXRvcnM/OiBBcnJheTxWYWxpZGF0b3JGbj47ICAvLyBBcnJheSBvZiBWYWxpZGF0b3JzLlxufVxuXG5cbmV4cG9ydCBjbGFzcyBTZWxlY3RMaXN0Q29uZmlnIGltcGxlbWVudHMgU2V0Q29udHJvbCB7XG4gIGFsbFZhbHVlO1xuICBhbGxMYWJlbCA9ICdBbGwnO1xuICBhbGxvd0FsbCA9IHRydWU7XG4gIGFsbG93R3JvdXBBbGw/ID0gdHJ1ZTtcbiAgYWxsT3ZlcmxheT8gPSBmYWxzZTtcbiAgYWxsT3ZlcmxheUVuYWJsZWQ/ID0gZmFsc2U7XG4gIGFsbE92ZXJsYXlMYWJlbD8gPSAnJztcbiAgYWxsT3ZlcmxheU1lc3NhZ2U/ID0gJyc7XG4gIGFsbE92ZXJsYXlDYWxsYmFjaz86IEV2ZW50Q2FsbGJhY2s7XG4gIGFsbCA9IGZhbHNlO1xuICBidWJibGUgPSBmYWxzZTtcbiAgY2hlY2tib3hQb3NpdGlvbiA9ICdiZWZvcmUnO1xuICBjb2xsYXBzZWQgPSBmYWxzZTtcbiAgY29udHJvbDogRm9ybUNvbnRyb2w7XG4gIGNvbHVtbiA9ICdjb2x1bW4nO1xuICBkaXNwbGF5RXJyb3JzID0gdHJ1ZTtcbiAgZGlzYWJsZU9wdGlvbjtcbiAgZGVmYXVsdEhlaWdodCA9IG51bGw7XG4gIGRlZmF1bHRNb2RlOnN0cmluZ3xudW1iZXI7XG4gIGRpc2FibGVkOiBib29sZWFuO1xuICBkaXNhYmxlZElkcyA9IFtdO1xuICBlbmFibGVPcHRpb247XG4gIGVtcHR5VmFsdWU7XG4gIGVtcHR5TGFiZWw7XG4gIGZhY2FkZSA9IGZhbHNlO1xuICBmaWx0ZXIgPSB0cnVlO1xuICBmb2N1c1NlYXJjaDtcbiAgZ3JvdXBzOiBTZWxlY3RMaXN0R3JvdXBJbnRlcmZhY2VbXTtcbiAgaGVscFRleHQgPSAnJztcbiAgaGVpZ2h0ID0gbnVsbDtcbiAgaWQ6IG51bWJlciB8IHN0cmluZztcbiAgbGV2ZWxHYXAgPSAzNTtcbiAgbGFiZWwgPSAnJztcbiAgbW9kZT86IEZpZWxkSXRlbU9wdGlvbltdO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIG11bHRpcGxlID0gZmFsc2U7XG4gIG1pbkhlaWdodCA9IG51bGw7XG4gIG5vSW5pdGlhbFZhbHVlID0gZmFsc2U7XG4gIG91dGxpbmUgPSB0cnVlO1xuICBvcHRpb25zPzogRmllbGRJdGVtT3B0aW9ucztcbiAgcGF0Y2g6IEZpZWxkSXRlbVBhdGNoSW50ZXJmYWNlO1xuICBwYXRjaEdyb3VwRmsgPSBmYWxzZTtcbiAgcmVxdWlyZWQ/OiBib29sZWFuO1xuICByb3V0ZTtcbiAgc2Vzc2lvbj86IGJvb2xlYW47XG4gIHNlc3Npb25QYXRoPzogc3RyaW5nO1xuICBzb3J0OiBib29sZWFuO1xuICBzZXREaXNhYmxlZDtcbiAgc3RyVmFsID0gJyc7XG4gIHNldEFjdGl2ZTtcbiAgc2V0SGVpZ2h0O1xuICBjbGVhclNlbGVjdGVkO1xuICBzZWxlY3RlZE9wdGlvbnM6IGFueVtdO1xuICB0cmlnZ2VyT25DaGFuZ2U7XG4gIHZhbHVlPzogQXJyYXk8bnVtYmVyIHwgc3RyaW5nPiB8IG51bWJlciB8IHN0cmluZztcbiAgdmFsaWRhdG9yczogQXJyYXk8VmFsaWRhdG9yRm4+O1xuXG5cbiAgY29uc3RydWN0b3IoIHBhcmFtcz86IFNlbGVjdExpc3RDb25maWdJbnRlcmZhY2UgKXtcbiAgICB0aGlzLnNldERlZmF1bHRWYWx1ZXMoKTtcbiAgICBpZiggcGFyYW1zICkgZm9yKCBjb25zdCBpIGluIHBhcmFtcyApIHRoaXNbIGkgXSA9IHBhcmFtc1sgaSBdO1xuICAgIGNvbnN0IG1vZGUgPSB0aGlzLm1vZGU7XG4gICAgY29uc3QgaGFzTW9kZSA9IElzQXJyYXkoIHRoaXMubW9kZSwgdHJ1ZSApID8gdHJ1ZSA6IGZhbHNlO1xuICAgIHRoaXMuZGVmYXVsdE1vZGUgPSBoYXNNb2RlID8gdGhpcy5tb2RlWyAwIF0udmFsdWUgOiAwO1xuICAgIHRoaXMudmFsdWUgPSBBcnJheS5pc0FycmF5KCB0aGlzLnZhbHVlICkgPyB0aGlzLnZhbHVlIDogW107XG4gICAgaWYoIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoID4gMSApe1xuICAgICAgaWYoIHRoaXMuc29ydCApe1xuICAgICAgICBpZiggdHlwZW9mIHRoaXMub3B0aW9ucy52YWx1ZXNbIDAgXS5zb3J0X29yZGVyICE9PSAndW5kZWZpbmVkJyApe1xuICAgICAgICAgIHRoaXMub3B0aW9ucy52YWx1ZXMuc29ydCggKCBhLCBiICkgPT4ge1xuICAgICAgICAgICAgaWYoIGEuc29ydF9vcmRlciA8IGIuc29ydF9vcmRlciApIHJldHVybiAtMTtcbiAgICAgICAgICAgIGlmKCBhLnNvcnRfb3JkZXIgPiBiLnNvcnRfb3JkZXIgKSByZXR1cm4gMTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgIH0gKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLnZhbHVlcy5zb3J0KCAoIGEsIGIgKSA9PiB7XG4gICAgICAgICAgICBpZiggYS5uYW1lIDwgYi5uYW1lICkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgaWYoIGEubmFtZSA+IGIubmFtZSApIHJldHVybiAxO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKCB0aGlzLm9wdGlvbnMudmFsdWVzWyAwIF0uZ3JvdXAgKXtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB0aGlzLmdldE9wdGlvbkdyb3VwcygpO1xuICAgICAgfWVsc2UgaWYoIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoICl7XG4gICAgICAgIGxldCBzdHI6IHN0cmluZ1tdID0gW107XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW107XG4gICAgICAgIHRoaXMub3B0aW9ucy52YWx1ZXMubWFwKCAoIG9wdGlvbiApID0+IHtcbiAgICAgICAgICBpZiggaGFzTW9kZSAmJiBJc1VuZGVmaW5lZCggb3B0aW9uLm1vZGUgKSApIG9wdGlvbi5tb2RlID0gdGhpcy5kZWZhdWx0TW9kZTtcbiAgICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSAoIDxhbnlbXT50aGlzLnZhbHVlICkuaW5jbHVkZXMoIG9wdGlvbi52YWx1ZSApID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgICAgIGlmKCBvcHRpb24uc2VsZWN0ZWQgKXtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnB1c2goIG9wdGlvbi52YWx1ZSApO1xuICAgICAgICAgICAgc3RyLnB1c2goIG9wdGlvbi5uYW1lICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wdGlvbi5pbmRlbnRhdGlvbiA9ICggK3RoaXMubGV2ZWxHYXAgKSAqICggb3B0aW9uLmxldmVsICsgMSApO1xuICAgICAgICAgIHN0ciA9IHN0ci5zb3J0KCk7XG4gICAgICAgICAgdGhpcy5zdHJWYWwgPSBzdHIuam9pbiggJywgJyApO1xuICAgICAgICB9ICk7XG4gICAgICAgIGlmKCB0aGlzLm9wdGlvbnMuZW1wdHkgKSB0aGlzLm9wdGlvbnMudmFsdWVzLnVuc2hpZnQoIHsgdmFsdWU6IHRoaXMub3B0aW9ucy5lbXB0eS52YWx1ZSwgbmFtZTogdGhpcy5vcHRpb25zLmVtcHR5Lm5hbWUgfSApO1xuICAgICAgICBjb25zdCBkZWZhdWx0R3JvdXAgPSB7XG4gICAgICAgICAgbGFiZWw6ICcnLFxuICAgICAgICAgIG9wdGlvbnM6IHRoaXMub3B0aW9ucyxcbiAgICAgICAgICBvcGVuOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ3JvdXBzID0gWyBkZWZhdWx0R3JvdXAgXTtcbiAgICAgIH1lbHNle1xuICAgICAgICB0aGlzLmdyb3VwcyA9IFtdO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiggIXRoaXMuZ3JvdXBzICkgdGhpcy5ncm91cHMgPSBbXTtcbiAgICBpZiggIXRoaXMubGV2ZWxHYXAgKSB0aGlzLmxldmVsR2FwID0gMzU7XG4gICAgdGhpcy5kZWZhdWx0SGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG5cbiAgICBsZXQgYWxsR3JvdXBzU2VsZWN0ZWQgPSB0cnVlO1xuICAgIGNvbnN0IHNlbGVjdGVkID0gdGhpcy5zZWxlY3RlZE9wdGlvbnM7XG4gICAgbGV0IGdyb3VwU2VsZWN0ZWQ7XG4gICAgaWYoIHRoaXMuYWxsICl7XG4gICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucyA9IFtdO1xuICAgICAgdGhpcy5ncm91cHMubWFwKCAoIGdyb3VwICkgPT4ge1xuICAgICAgICBncm91cC5hbGwgPSB0cnVlO1xuICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucyA9IGdyb3VwLm9wdGlvbnMudmFsdWVzLm1hcCggKCBvcHRpb24gKSA9PiB7XG4gICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKCBvcHRpb24udmFsdWUgKTtcbiAgICAgICAgfSApO1xuICAgICAgfSApO1xuICAgICAgdGhpcy5zdHJWYWwgPSB0aGlzLmFsbExhYmVsO1xuICAgIH1lbHNle1xuICAgICAgbGV0IHN0cjogc3RyaW5nW10gPSBbXTtcbiAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW107XG4gICAgICBjb25zdCBpc0dyb3VwcyA9IHRoaXMuZ3JvdXBzLmxlbmd0aCA+IDE7XG5cbiAgICAgIHRoaXMuZ3JvdXBzLm1hcCggKCBncm91cDogU2VsZWN0RmlsdGVyR3JvdXBJbnRlcmZhY2UgKSA9PiB7XG4gICAgICAgIGlmKCBncm91cC5hbGwgKXtcbiAgICAgICAgICBpZiggaXNHcm91cHMgKXtcbiAgICAgICAgICAgIHN0ci5wdXNoKCBncm91cC5sYWJlbCArICcgKEFsbCknICk7XG4gICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICBzdHIucHVzaCggJ0FsbCcgKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZ3JvdXAub3B0aW9ucy52YWx1ZXMuZmlsdGVyKCBvcHRpb24gPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMucHVzaCggb3B0aW9uLnZhbHVlICk7XG4gICAgICAgICAgfSApO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICBncm91cFNlbGVjdGVkID0gZ3JvdXAub3B0aW9ucy52YWx1ZXMuZmlsdGVyKCAoIG9wdGlvbiApID0+IHtcbiAgICAgICAgICAgIHJldHVybiBvcHRpb24uc2VsZWN0ZWQ7XG4gICAgICAgICAgfSApO1xuICAgICAgICAgIGlmKCBncm91cFNlbGVjdGVkICYmIGdyb3VwU2VsZWN0ZWQubGVuZ3RoICl7XG4gICAgICAgICAgICBpZiggZ3JvdXBTZWxlY3RlZC5sZW5ndGggPT09IGdyb3VwLm9wdGlvbnMudmFsdWVzLmxlbmd0aCApIGdyb3VwLmFsbCA9IHRydWU7XG4gICAgICAgICAgICBpZiggZ3JvdXAuYWxsICl7XG4gICAgICAgICAgICAgIGlmKCBpc0dyb3VwcyApe1xuICAgICAgICAgICAgICAgIHN0ci5wdXNoKCBncm91cC5sYWJlbCArICcgKEFsbCknICk7XG4gICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIHN0ci5wdXNoKCAnQWxsJyApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGdyb3VwLm9wdGlvbnMudmFsdWVzLmZpbHRlciggb3B0aW9uID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKCBvcHRpb24udmFsdWUgKTtcbiAgICAgICAgICAgICAgfSApO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIGFsbEdyb3Vwc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgIGlmKCBpc0dyb3VwcyAmJiBncm91cFNlbGVjdGVkLmxlbmd0aCApe1xuICAgICAgICAgICAgICAgIHN0ci5wdXNoKCBncm91cC5sYWJlbCArIGAgKCR7Z3JvdXBTZWxlY3RlZC5sZW5ndGh9IG9mICR7Z3JvdXAub3B0aW9ucy52YWx1ZXMubGVuZ3RofSlgICk7XG4gICAgICAgICAgICAgICAgZ3JvdXBTZWxlY3RlZC5tYXAoICggb3B0aW9uOiBhbnkgKSA9PiB7XG4gICAgICAgICAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKCBvcHRpb24udmFsdWUgKTtcbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGdyb3VwU2VsZWN0ZWQubWFwKCAoIG9wdGlvbjogYW55ICkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMucHVzaCggb3B0aW9uLnZhbHVlICk7XG4gICAgICAgICAgICAgICAgICBzdHIucHVzaCggb3B0aW9uLm5hbWUgKTtcbiAgICAgICAgICAgICAgICB9ICk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIGdyb3VwLmFsbCA9IGZhbHNlO1xuICAgICAgICAgICAgYWxsR3JvdXBzU2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gKTtcbiAgICAgIGlmKCAhdGhpcy5zZWxlY3RlZE9wdGlvbnMubGVuZ3RoICl7XG4gICAgICAgIGFsbEdyb3Vwc1NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgIGlmKCB0aGlzLmVtcHR5TGFiZWwgKXtcbiAgICAgICAgICBzdHIgPSBbIHRoaXMuZW1wdHlMYWJlbCBdO1xuICAgICAgICB9XG4gICAgICB9ZWxzZSBpZiggIXRoaXMuYWxsICYmIGFsbEdyb3Vwc1NlbGVjdGVkICl7XG4gICAgICAgIHN0ciA9IFsgJ0FsbCcgXTtcbiAgICAgIH1cbiAgICAgIHRoaXMuYWxsID0gYWxsR3JvdXBzU2VsZWN0ZWQ7XG4gICAgICBzdHIgPSBzdHIuc29ydCgpO1xuICAgICAgdGhpcy5zdHJWYWwgPSBzdHIuam9pbiggJywgJyApO1xuICAgIH1cblxuICAgIGRlbGV0ZSB0aGlzLm9wdGlvbnM7XG4gICAgZGVsZXRlIHRoaXMudmFsdWU7XG5cbiAgICBpZiggIXRoaXMucGF0Y2ggKSB0aGlzLnBhdGNoID0geyBmaWVsZDogJycsIGR1cmF0aW9uOiA3NTAsIHBhdGg6ICcnLCBkaXNhYmxlZDogZmFsc2UgfTtcbiAgICBpZiggdGhpcy5wYXRjaC5kaXNwbGF5SW5kaWNhdG9yICE9PSBmYWxzZSApIHRoaXMucGF0Y2guZGlzcGxheUluZGljYXRvciA9IHRydWU7XG4gICAgaWYoIHRoaXMuZ3JvdXBzLmxlbmd0aCA9PT0gMSApIHRoaXMuY29sbGFwc2VkID0gZmFsc2U7XG4gICAgaWYoIHRoaXMubm9Jbml0aWFsVmFsdWUgKSB0aGlzLnZhbHVlID0gdGhpcy5tdWx0aXBsZSA/IFtdIDogJyc7XG4gICAgaWYoICF0aGlzLmNvbnRyb2wgKSB0aGlzLnNldENvbnRyb2woKTtcbiAgICBpZiggISggSXNEZWZpbmVkKCB0aGlzLnZhbHVlLCBmYWxzZSApICkgKSB0aGlzLnZhbHVlID0gdGhpcy5tdWx0aXBsZSA/IFtdIDogJyc7XG5cbiAgICBpZiggdGhpcy5hbGxPdmVybGF5ICYmICF0aGlzLmFsbE92ZXJsYXlMYWJlbCApe1xuICAgICAgdGhpcy5hbGxPdmVybGF5TGFiZWwgPSAnQWxsIEFjY2Vzcyc7XG4gICAgfVxuICB9XG5cblxuICBzZXRDb250cm9sKCl7XG4gICAgdGhpcy5jb250cm9sID0gKCB0aGlzLmRpc2FibGVkID8gbmV3IEZvcm1Db250cm9sKCB7XG4gICAgICB2YWx1ZTogdGhpcy52YWx1ZSxcbiAgICAgIGRpc2FibGVkOiBmYWxzZVxuICAgIH0gKSA6IG5ldyBGb3JtQ29udHJvbCggdGhpcy52YWx1ZSwgKCB0aGlzLnZhbGlkYXRvcnMgPyB0aGlzLnZhbGlkYXRvcnMgOiBbXSApICkgKTtcbiAgfVxuXG5cbiAgcHJpdmF0ZSBzZXREZWZhdWx0VmFsdWVzKCk6IHZvaWR7XG4gICAgLy8gdGhpcy5oZWxwVGV4dCA9ICcnO1xuICAgIHRoaXMubGFiZWwgPSAnJztcbiAgICB0aGlzLm1lc3NhZ2UgPSAnJztcbiAgICB0aGlzLm9wdGlvbnMgPSB7IHZhbHVlczogW10gfTtcbiAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgdGhpcy5zb3J0ID0gZmFsc2U7XG4gICAgLy8gdGhpcy5zaG93VG9vbHRpcCA9IGZhbHNlO1xuICAgIC8vIHRoaXMudG9vbHRpcCA9ICcnO1xuICB9XG5cblxuICBwcml2YXRlIGdldE9wdGlvbkdyb3VwcygpOiBTZWxlY3RMaXN0R3JvdXBJbnRlcmZhY2VbXXtcbiAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucyA9IFtdO1xuXG4gICAgY29uc3QgZ3JvdXBzID0ge307XG4gICAgY29uc3QgbGlzdCA9IFtdO1xuICAgIGxldCBkZWZhdWx0R3JvdXAgPSB0aGlzLm9wdGlvbnMudmFsdWVzWyAwIF0uZ3JvdXA7XG4gICAgbGV0IGRlZmF1bHRHcm91cEZrID0gdGhpcy5vcHRpb25zLnZhbHVlc1sgMCBdLmdyb3VwRms7XG4gICAgdGhpcy5vcHRpb25zLnZhbHVlcy5tYXAoICggb3B0aW9uLCBpbmRleCApID0+IHtcbiAgICAgIGlmKCB0eXBlb2Ygb3B0aW9uLmxldmVsID09PSAndW5kZWZpbmVkJyApIG9wdGlvbi5sZXZlbCA9IDA7XG4gICAgICBpZiggdGhpcy5tb2RlICYmIElzVW5kZWZpbmVkKCBvcHRpb24ubW9kZSApICkgb3B0aW9uLm1vZGUgPSB0aGlzLmRlZmF1bHRNb2RlO1xuICAgICAgb3B0aW9uLmluZGVudGF0aW9uID0gKCArdGhpcy5sZXZlbEdhcCApICogKCBvcHRpb24ubGV2ZWwgKyAxICk7XG4gICAgICBpZiggIW9wdGlvbi5ncm91cCApIG9wdGlvbi5ncm91cCA9IGRlZmF1bHRHcm91cDtcbiAgICAgIGlmKCBvcHRpb24uZ3JvdXAgaW4gZ3JvdXBzID09PSBmYWxzZSApe1xuICAgICAgICBncm91cHNbIG9wdGlvbi5ncm91cCBdID0gPFNlbGVjdExpc3RHcm91cEludGVyZmFjZT4ge1xuICAgICAgICAgIGxhYmVsOiBvcHRpb24uZ3JvdXAsXG4gICAgICAgICAgb3B0aW9uczogeyB2YWx1ZXM6IFtdIH0sXG4gICAgICAgICAgYWxsOiBmYWxzZSxcbiAgICAgICAgICBpbmRldGVybWluYXRlOiBmYWxzZSxcbiAgICAgICAgICBvcGVuOiB0cnVlLFxuICAgICAgICAgIGdyb3VwRms6IG9wdGlvbi5ncm91cEZrLFxuICAgICAgICB9O1xuICAgICAgICBkZWZhdWx0R3JvdXAgPSBvcHRpb24uZ3JvdXA7XG4gICAgICAgIGRlZmF1bHRHcm91cEZrID0gb3B0aW9uLmdyb3VwRms7XG4gICAgICB9XG4gICAgICBvcHRpb24uc2VsZWN0ZWQgPSAoIDxhbnlbXT50aGlzLnZhbHVlICkuaW5jbHVkZXMoIG9wdGlvbi52YWx1ZSApO1xuICAgICAgaWYoIG9wdGlvbi5zZWxlY3RlZCApe1xuICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKCBvcHRpb24udmFsdWUgKTtcbiAgICAgIH1cbiAgICAgIGdyb3Vwc1sgb3B0aW9uLmdyb3VwIF0ub3B0aW9ucy52YWx1ZXMucHVzaCggb3B0aW9uICk7XG4gICAgfSApO1xuXG4gICAgY29uc3QgY291bnQgPSBPYmplY3Qua2V5cyggZ3JvdXBzICkubGVuZ3RoO1xuICAgIE9iamVjdC5rZXlzKCBncm91cHMgKS5tYXAoICgga2V5ICkgPT4ge1xuICAgICAgbGV0IGluZGV0ZXJtaW5hdGUgPSBmYWxzZTtcbiAgICAgIGxldCBhbGwgPSB0cnVlO1xuICAgICAgZ3JvdXBzWyBrZXkgXS5vcHRpb25zLnZhbHVlcy5zb21lKCBvcHRpb24gPT4ge1xuICAgICAgICBpZiggIW9wdGlvbi5zZWxlY3RlZCApe1xuICAgICAgICAgIGFsbCA9IGZhbHNlO1xuICAgICAgICAgIGluZGV0ZXJtaW5hdGUgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9ICk7XG4gICAgICBncm91cHNbIGtleSBdLmFsbCA9IGFsbDtcbiAgICAgIGdyb3Vwc1sga2V5IF0uaW5kZXRlcm1pbmF0ZSA9IGluZGV0ZXJtaW5hdGU7XG4gICAgICBpZiggY291bnQgPiAxICYmIHRoaXMuY29sbGFwc2VkICkgZ3JvdXBzWyBrZXkgXS5vcGVuID0gZmFsc2U7XG4gICAgICBsaXN0LnB1c2goIGdyb3Vwc1sga2V5IF0gKTtcbiAgICB9ICk7XG4gICAgY29uc3QgY291bnRMYWJlbCA9IHRoaXMuc2VsZWN0ZWRPcHRpb25zLmxlbmd0aCA+IDEgPyBgWyR7dGhpcy5zZWxlY3RlZE9wdGlvbnMubGVuZ3RofV0gYCA6ICcnO1xuXG4gICAgcmV0dXJuIGxpc3Q7XG4gIH1cblxuXG4gIHB1YmxpYyByZXNldFNlbGVjdGlvbigpOiB2b2lke1xuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW107XG4gIH1cblxuXG4gIHB1YmxpYyBhZGRTZWxlY3RlZE9wdGlvbiggb3B0aW9uOiBudW1iZXIgKTogdm9pZHtcbiAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKCBvcHRpb24gKTtcbiAgfVxufVxuXG4iXX0=