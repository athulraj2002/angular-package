import { FormControl } from '@angular/forms';
import { IsArray } from '../../../../pop-common-utility';
export class SelectFilterConfig {
    constructor(params) {
        this.allLabel = 'All';
        this.all = false;
        this.allowAll = true;
        this.bubble = false;
        this.displayErrors = true;
        this.collapsed = false;
        this.checkboxPosition = 'before';
        this.defaultMinHeight = 1;
        this.facade = false;
        this.float = false;
        this.filter = true;
        this.helpText = '';
        this.height = 200;
        this.levelGap = 35;
        this.minHeight = 50;
        this.multiple = false;
        this.name = 'name';
        this.noInitialValue = false;
        this.offset = null;
        this.offsetSession = null;
        this.patchGroupFk = false;
        this.strVal = '';
        this.setDefaultValues();
        if (params)
            for (const i in params)
                this[i] = params[i];
        this.value = this.multiple ? (Array.isArray(this.value) ? this.value : []) : (+this.value ? this.value : null);
        if (this.options.values.length > 1) {
            if (this.sort) {
                if (typeof this.options.values[0].sort_order !== 'undefined') {
                    this.options.values.sort((a, b) => {
                        if (a.sort_order < b.sort_order)
                            return -1;
                        if (a.sort_order > b.sort_order)
                            return 1;
                        return 0;
                    });
                }
                else {
                    this.options.values.sort((a, b) => {
                        if (a.name < b.name)
                            return -1;
                        if (a.name > b.name)
                            return 1;
                        return 0;
                    });
                }
            }
            if (this.options.values[0].group) {
                this.groups = this.getOptionGroups();
                if (this.groups.length < 2) {
                    this.allowAll = false;
                }
            }
            else {
                const str = [];
                this.selectedOptions = [];
                this.options.values.map((option) => {
                    if (this.all) {
                        option.selected = true;
                        this.selectedOptions.push(option.value);
                    }
                    else {
                        option.selected = IsArray(this.value) ? (this.value.includes(option.value) ? true : false) : false;
                        if (option.selected) {
                            this.selectedOptions.push(option.value);
                            str.push(option.name);
                        }
                    }
                    option.level = this.levelGap * option.level;
                });
                const defaultGroup = {
                    label: '',
                    options: this.options,
                    groupFk: 0,
                    open: true,
                };
                this.groups = [defaultGroup];
            }
        }
        if (!this.levelGap)
            this.levelGap = 35;
        this.defaultHeight = this.height;
        this.all = IsArray(this.value) ? (this.options.values.length === this.value.length) : false;
        if (!this.position)
            this.position = 'below';
        if (!this.patch)
            this.patch = { field: '', duration: 750, path: '', disabled: false };
        if (this.patch.displayIndicator !== false)
            this.patch.displayIndicator = true;
        if (this.groups.length === 1)
            this.collapsed = false;
        if (this.noInitialValue)
            this.value = this.multiple ? [] : '';
        if (!this.control)
            this.setControl();
    }
    setControl() {
        this.control = (this.disabled ? new FormControl({
            value: this.value,
            disabled: true
        }) : new FormControl(this.value, (this.validators ? this.validators : [])));
    }
    setDefaultValues() {
        // this.helpText = '';
        this.label = '';
        this.message = '';
        this.options = { values: [] };
        this.disabled = false;
        this.sort = false;
        // this.showTooltip = false;
        // this.tooltip = '';
    }
    getOptionGroups() {
        this.selectedOptions = [];
        const groups = {};
        const list = [];
        let defaultGroup = this.options.values[0].group;
        this.options.values.map((option, index) => {
            if (typeof option.level === 'undefined')
                option.level = 0;
            option.level = this.levelGap * option.level;
            if (!option.group)
                option.group = defaultGroup;
            if (option.group in groups === false) {
                groups[option.group] = {
                    label: option.group,
                    groupFk: option.groupFk,
                    options: {
                        values: [],
                        filtered: []
                    },
                    all: false,
                    open: true,
                    indeterminate: false,
                };
                defaultGroup = option.group;
            }
            if (this.all) {
                option.selected = true;
                this.selectedOptions.push(option.value);
            }
            else {
                option.selected = IsArray(this.value) ? this.value.includes(option.value) : false;
                if (option.selected) {
                    this.selectedOptions.push(option.value);
                }
            }
            groups[option.group].options.values.push(option);
        });
        const count = Object.keys(groups).length;
        Object.keys(groups).map((key) => {
            const group = groups[key];
            // if(IsArray(group.options.values)){
            //   // ToDo:: allow ordering by a sort order property
            //   group.options.values = group.options.values.sort(DynamicSort('name'));
            // }
            if (count > 1 && this.collapsed)
                group.open = false;
            list.push(groups[key]);
        });
        return list;
    }
    resetSelection() {
        this.selectedOptions = [];
    }
    addSelectedOption(option) {
        this.selectedOptions.push(option);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VsZWN0LWZpbHRlci1jb25maWcubW9kZWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9wb3AtY29tbW9uL3NyYy9saWIvbW9kdWxlcy9iYXNlL3BvcC1maWVsZC1pdGVtL3BvcC1zZWxlY3QtZmlsdGVyL3NlbGVjdC1maWx0ZXItY29uZmlnLm1vZGVsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxXQUFXLEVBQWUsTUFBTSxnQkFBZ0IsQ0FBQztBQUcxRCxPQUFPLEVBQWUsT0FBTyxFQUFZLE1BQU0sZ0NBQWdDLENBQUM7QUFvRGhGLE1BQU0sT0FBTyxrQkFBa0I7SUE4QzdCLFlBQWEsTUFBb0M7UUE3Q2pELGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsUUFBRyxHQUFHLEtBQUssQ0FBQztRQUVaLGFBQVEsR0FBRyxJQUFJLENBQUM7UUFDaEIsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBQ3JCLGNBQVMsR0FBRyxLQUFLLENBQUM7UUFDbEIscUJBQWdCLEdBQUcsUUFBUSxDQUFDO1FBRzVCLHFCQUFnQixHQUFHLENBQUMsQ0FBQztRQUlyQixXQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ2YsVUFBSyxHQUFJLEtBQUssQ0FBQztRQUNmLFdBQU0sR0FBRyxJQUFJLENBQUM7UUFFZCxhQUFRLEdBQUcsRUFBRSxDQUFDO1FBQ2QsV0FBTSxHQUFHLEdBQUcsQ0FBQztRQUdiLGFBQVEsR0FBRyxFQUFFLENBQUM7UUFHZCxjQUFTLEdBQUcsRUFBRSxDQUFDO1FBQ2YsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQixTQUFJLEdBQUcsTUFBTSxDQUFDO1FBQ2QsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFDdkIsV0FBTSxHQUFHLElBQUksQ0FBQztRQUNkLGtCQUFhLEdBQUcsSUFBSSxDQUFDO1FBR3JCLGlCQUFZLEdBQUcsS0FBSyxD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Q2QsQ0FBQztJQUdNLGNBQWM7UUFDbkIsSUFBSSxDQUFDLGVBQWUsR0FBRyxFQUFFLENBQUM7SUFDNUIsQ0FBQztJQUdNLGlCQUFpQixDQUFFLE1BQWM7UUFDdEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUUsTUFBTSxDQUFFLENBQUM7SUFDdEMsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRm9ybUNvbnRyb2wsIFZhbGlkYXRvckZuIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgRmllbGRJdGVtT3B0aW9uLCBGaWVsZEl0ZW1PcHRpb25zLCBGaWVsZEl0ZW1QYXRjaEludGVyZmFjZSB9IGZyb20gJy4uLy4uLy4uLy4uL3BvcC1jb21tb24ubW9kZWwnO1xuaW1wb3J0IHsgU2V0Q29udHJvbCB9IGZyb20gJy4uLy4uLy4uLy4uL3BvcC1jb21tb24tZG9tLm1vZGVscyc7XG5pbXBvcnQgeyBEeW5hbWljU29ydCwgSXNBcnJheSwgSXNOdW1iZXIgfSBmcm9tICcuLi8uLi8uLi8uLi9wb3AtY29tbW9uLXV0aWxpdHknO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VsZWN0RmlsdGVyR3JvdXBJbnRlcmZhY2Uge1xuICBsYWJlbDogc3RyaW5nOyAgICAgICAgICAgICAgICAgICAvLyBJbnB1dCBsYWJlbC5cbiAgb3B0aW9uczogRmllbGRJdGVtT3B0aW9uczsgICAgICAgICAgLy8gQXJyYXkgb2YgRmllbGRPcHRpb25zXG4gIGFsbD86IGJvb2xlYW47XG4gIGluZGV0ZXJtaW5hdGU/OiBib29sZWFuO1xuICBncm91cEZrOiBudW1iZXI7XG4gIHZpc2libGU/OiBudW1iZXI7IC8vIHRoZSBjb3VudCBvZiAgdmlzaWJsZSBvcHRpb25zIHdpdGhpbiB0aGUgZ3JvdXBcbiAgb3Blbj86IGJvb2xlYW47XG4gIHNlbGVjdGVkPzogbnVtYmVyOyAvLyB0aGUgY291bnQgb2Ygc2VsZWN0ZWQgdmlzaWJsZSBvcHRpb25zIHdpdGhpbiB0aGUgZ3JvdXBcbn1cblxuXG5leHBvcnQgaW50ZXJmYWNlIFNlbGVjdEZpbHRlckNvbmZpZ0ludGVyZmFjZSB7XG4gIGFsbExhYmVsPzogc3RyaW5nOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHN0cmluZyB0byBhcyBsYWJlbCB0byBpbmRpY2F0ZSB0aGF0IGFsbCBvcHRpb25zIGFyZSBzZWxlY3RlZFxuICBhbGw/OiBib29sZWFuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCBib29sZWFuIHRvIGluZGljYXRlIHRoYXQgYWxsIG9wdGlvbnMgYXJlIHNlbGVjdGVkXG4gIGFsbFZhbHVlPzogYm9vbGVhbiB8IHN0cmluZyB8IG51bWJlciB8IG51bGwgfCBhbnlbXTsgICAgLy8gQSBjdXN0b20gdmFsdWUgZm9yIHdoZW4gYWxsIG9wdGlvbnMgYXJlIHNlbGVjdGVkXG4gIGFsbG93QWxsPzogYm9vbGVhbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IGJvb2xlYW4gdG8gaW5kaWNhdGUgd2hldGhlciB0byBzZXQgY2hlY2sgYWxsIG9wdGlvblxuICBidWJibGU/OiBib29sZWFuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZpcmUgZXZlbnRzXG4gIGNoZWNrYm94UG9zaXRpb24/OiBzdHJpbmc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcG9zaXRpb24gb2YgdGhlIGNoZWNrYm94IGZvciBhIG11bHRpcGxlIHNlbGVjdGlvbi5cbiAgY29sbGFwc2VkPzogYm9vbGVhbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTZXQgdG8gdHJ1ZSBvbiBtYXNzaXZlIHNldHMgdG8gc2hvdyBvbmx5IG9wdGlvbiBoZWFkZXJzIG9uIHJlbmRlclxuICBjb250cm9sPzogRm9ybUNvbnRyb2w7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoZSBmb3JtIGNvbnRyb2wuIElmIG5vdCBwYXNzZWQgb25lIHdpbGwgYmUgY3JlYXRlZC5cbiAgZGlzYWJsZWQ/OiBib29sZWFuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBNYXJrIGFzIHJlYWRvbmx5LlxuICBkaXNwbGF5RXJyb3JzPzogYm9vbGVhbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIEVycm9yIG1lc3NhZ2VzIHNob3VsZCBiZSBkaXNwbGF5ZWQuXG4gIGVtcHR5TGFiZWw/OiBzdHJpbmc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHN0cmluZyBhcyBsYWJlbCB0byB3aGVuIG5vIG9wdGlvbnMgYXJlIHNlbGVjdGVkXG4gIGVtcHR5VmFsdWU/OiBib29sZWFuIHwgc3RyaW5nIHwgbnVtYmVyIHwgbnVsbCB8IGFueVtdOyAgLy8gQSBjdXN0b20gdmFsdWUgZm9yIHdoZW4gYWxsIG9wdGlvbnMgYXJlIHVuc2VsZWN0ZWRcbiAgZmxvYXQ/OiBib29sZWFuO1xuICBmaWx0ZXI/OiBib29sZWFuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNlYXJjaCBmaWx0ZXIuXG4gIGZhY2FkZT86IGJvb2xlYW47ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0cyBhIGZsYWcgdGhhdCBzYXlzIHRoaXMgZmllbGRJdGVtcyByZWFsbHkgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGJhY2tlbmQsIGFuZCBqdXN0IHByZXRlbmQgdG8gaGl0IHRoZSBhcGlcbiAgaGVscFRleHQ/OiBzdHJpbmc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBPbiBob3ZlciBoZWxwZXIgdGV4dC5cbiAgaGVpZ2h0PzogbnVtYmVyOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBMaXN0IGhlaWdodC5cbiAgaWQ/OiBudW1iZXIgfCBzdHJpbmc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBIG51bWJlciB0aGF0IHdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIGV2ZW50cyBzbyB5b3Uga25vdyB3aGljaCBmaWVsZCBpdCBjYW1lIGZyb20uXG4gIGxldmVsR2FwPzogbnVtYmVyO1xuICBsYWJlbD86IHN0cmluZzsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElucHV0IGxhYmVsLlxuICBtZXRhZGF0YT86IG9iamVjdDsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXJyYXkgb2Ygb2JqZWN0cy4gVG8gYmUgcGFzc2VkIGJhY2sgb24gdGhlIGV2ZW50IGVtaXR0ZXIgYW5kIGluY2x1ZGVkIGluIGEgcGF0Y2ggaWYgZGVzaXJlZC5cbiAgbXVsdGlwbGU/OiBib29sZWFuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBtdWx0aXBsZSBpcyBuZWVkZWQuXG4gIG5hbWU/OiBzdHJpbmc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgZW50aXR5SWQgZmllbGQgbmFtZVxuICBub0luaXRpYWxWYWx1ZT86Ym9vbGVhbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0byB0cnVlIHRvIGFsd2F5cyBoYXZlIGFuIGVtcHR5IHZhbHVlIG9uIGxvYWRcbiAgb3B0aW9ucz86IEZpZWxkSXRlbU9wdGlvbnM7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBBcnJheSBvZiBGaWVsZE9wdGlvbnNcbiAgcGF0Y2g/OiBGaWVsZEl0ZW1QYXRjaEludGVyZmFjZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBmaWVsZCBzaG91bGQgYmUgYXV0by1wYXRjaGVkLlxuICBwYXRjaEdyb3VwRms/OiBib29sZWFuOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIHZhbHVlIHNob3VsZCBjb250YWluIGdyb3VwRmssIDM6MTIsNDoxMiw1OjEzIDx2YWx1ZTpncm91cEZrPlxuICBzZXNzaW9uPzogYm9vbGVhbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElmIGZpZWxkIHZhbHVlIGNoYW5nZSBzaG91bGQgYmUgc3RvcmVkIHRvIGNvcmUgZW50aXR5XG4gIHNlc3Npb25QYXRoPzogc3RyaW5nOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBzZXNzaW9uIHBhdGggaWYgbm90IHN0b3JlZCBvbiByb290IGVudGl0eVxuICBzb3J0PzogYm9vbGVhbjsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vICBTZXQgdG8gdHJ1ZSBpZiB5b3Ugd2FudCBvcHRpb25zIHRvIGJlIHNvcnRlZCBpbiBwcmlvcml0eSBvZiBzb3J0X29yZGVyLCBuYW1lXG4gIHBvc2l0aW9uPzogJ2Fib3ZlJyB8ICdiZWxvdyc7ICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gbGlzdCBwb3NpdGlvblxuICB2YWx1ZT86IEFycmF5PG51bWJlciB8IHN0cmluZz4gfCBudW1iZXIgfCBzdHJpbmc7ICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWwgdmFsdWUuXG4gIHZhbGlkYXRvcnM/OiBBcnJheTxWYWxpZGF0b3JGbj47ICAgICAgICAgICAgICAgICAgICAgICAgLy8gQXJyYXkgb2YgVmFsaWRhdG9ycy5cbn1cblxuXG5leHBvcnQgY2xhc3MgU2VsZWN0RmlsdGVyQ29uZmlnIGltcGxlbWVudHMgU2V0Q29udHJvbCB7XG4gIGFsbExhYmVsID0gJ0FsbCc7XG4gIGFsbCA9IGZhbHNlO1xuICBhbGxWYWx1ZTtcbiAgYWxsb3dBbGwgPSB0cnVlO1xuICBidWJibGUgPSBmYWxzZTtcbiAgZGlzcGxheUVycm9ycyA9IHRydWU7XG4gIGNvbGxhcHNlZCA9IGZhbHNlO1xuICBjaGVja2JveFBvc2l0aW9uID0gJ2JlZm9yZSc7XG4gIGNvbnRyb2w6IEZvcm1Db250cm9sO1xuICBkZWZhdWx0SGVpZ2h0O1xuICBkZWZhdWx0TWluSGVpZ2h0ID0gMTtcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIGVtcHR5VmFsdWU7XG4gIGVtcHR5TGFiZWw7XG4gIGZhY2FkZSA9IGZhbHNlO1xuICBmbG9hdD8gPSBmYWxzZTtcbiAgZmlsdGVyID0gdHJ1ZTtcbiAgZ3JvdXBzOiBTZWxlY3RGaWx0ZXJHcm91cEludGVyZmFjZVtdO1xuICBoZWxwVGV4dCA9ICcnO1xuICBoZWlnaHQgPSAyMDA7XG4gIGlkOiBudW1iZXIgfCBzdHJpbmc7XG4gIGxhYmVsOiBzdHJpbmc7XG4gIGxldmVsR2FwID0gMzU7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgbWV0YWRhdGE7XG4gIG1pbkhlaWdodCA9IDUwO1xuICBtdWx0aXBsZSA9IGZhbHNlO1xuICBuYW1lID0gJ25hbWUnO1xuICBub0luaXRpYWxWYWx1ZSA9IGZhbHNlO1xuICBvZmZzZXQgPSBudWxsO1xuICBvZmZzZXRTZXNzaW9uID0gbnVsbDtcbiAgb3B0aW9ucz86IEZpZWxkSXRlbU9wdGlvbnM7XG4gIHBhdGNoOiBGaWVsZEl0ZW1QYXRjaEludGVyZmFjZTtcbiAgcGF0Y2hHcm91cEZrID0gZmFsc2U7XG4gIHBvc2l0aW9uO1xuICBzZXNzaW9uPzogYm9vbGVhbjtcbiAgc2Vzc2lvblBhdGg/OiBzdHJpbmc7XG4gIHNvcnQ6IGJvb2xlYW47XG4gIHNlbGVjdGVkT3B0aW9uczogYW55W107XG4gIHN0clZhbCA9ICcnO1xuICB2YWx1ZT86IEFycmF5PG51bWJlciB8IHN0cmluZz4gfCBudW1iZXIgfCBzdHJpbmc7XG4gIHZhbGlkYXRvcnM6IEFycmF5PFZhbGlkYXRvckZuPjtcbiAgcm91dGU7XG5cblxuICBjb25zdHJ1Y3RvciggcGFyYW1zPzogU2VsZWN0RmlsdGVyQ29uZmlnSW50ZXJmYWNlICl7XG4gICAgdGhpcy5zZXREZWZhdWx0VmFsdWVzKCk7XG4gICAgaWYoIHBhcmFtcyApIGZvciggY29uc3QgaSBpbiBwYXJhbXMgKSB0aGlzWyBpIF0gPSBwYXJhbXNbIGkgXTtcblxuICAgIHRoaXMudmFsdWUgPSB0aGlzLm11bHRpcGxlID8gKCBBcnJheS5pc0FycmF5KCB0aGlzLnZhbHVlICkgPyB0aGlzLnZhbHVlIDogW10gKSA6ICggK3RoaXMudmFsdWUgPyB0aGlzLnZhbHVlIDogbnVsbCApO1xuXG4gICAgaWYoIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoID4gMSApe1xuICAgICAgaWYoIHRoaXMuc29ydCApe1xuICAgICAgICBpZiggdHlwZW9mIHRoaXMub3B0aW9ucy52YWx1ZXNbIDAgXS5zb3J0X29yZGVyICE9PSAndW5kZWZpbmVkJyApe1xuICAgICAgICAgIHRoaXMub3B0aW9ucy52YWx1ZXMuc29ydCggKCBhLCBiICkgPT4ge1xuICAgICAgICAgICAgaWYoIGEuc29ydF9vcmRlciA8IGIuc29ydF9vcmRlciApIHJldHVybiAtMTtcbiAgICAgICAgICAgIGlmKCBhLnNvcnRfb3JkZXIgPiBiLnNvcnRfb3JkZXIgKSByZXR1cm4gMTtcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgIH0gKTtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgdGhpcy5vcHRpb25zLnZhbHVlcy5zb3J0KCAoIGEsIGIgKSA9PiB7XG4gICAgICAgICAgICBpZiggYS5uYW1lIDwgYi5uYW1lICkgcmV0dXJuIC0xO1xuICAgICAgICAgICAgaWYoIGEubmFtZSA+IGIubmFtZSApIHJldHVybiAxO1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgfSApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmKCB0aGlzLm9wdGlvbnMudmFsdWVzWyAwIF0uZ3JvdXAgKXtcbiAgICAgICAgdGhpcy5ncm91cHMgPSB0aGlzLmdldE9wdGlvbkdyb3VwcygpO1xuICAgICAgICBpZiggdGhpcy5ncm91cHMubGVuZ3RoIDwgMiApe1xuICAgICAgICAgIHRoaXMuYWxsb3dBbGwgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfWVsc2V7XG4gICAgICAgIGNvbnN0IHN0cjogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5vcHRpb25zLnZhbHVlcy5tYXAoICggb3B0aW9uICkgPT4ge1xuICAgICAgICAgIGlmKCB0aGlzLmFsbCApe1xuICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnB1c2goIG9wdGlvbi52YWx1ZSApO1xuICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gSXNBcnJheSggdGhpcy52YWx1ZSApID8gKCAoIDxhbnlbXT50aGlzLnZhbHVlICkuaW5jbHVkZXMoIG9wdGlvbi52YWx1ZSApID8gdHJ1ZSA6IGZhbHNlICkgOiBmYWxzZTtcbiAgICAgICAgICAgIGlmKCBvcHRpb24uc2VsZWN0ZWQgKXtcbiAgICAgICAgICAgICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMucHVzaCggb3B0aW9uLnZhbHVlICk7XG4gICAgICAgICAgICAgIHN0ci5wdXNoKCBvcHRpb24ubmFtZSApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBvcHRpb24ubGV2ZWwgPSB0aGlzLmxldmVsR2FwICogb3B0aW9uLmxldmVsO1xuICAgICAgICB9ICk7XG4gICAgICAgIGNvbnN0IGRlZmF1bHRHcm91cCA9IHtcbiAgICAgICAgICBsYWJlbDogJycsXG4gICAgICAgICAgb3B0aW9uczogdGhpcy5vcHRpb25zLFxuICAgICAgICAgIGdyb3VwRms6IDAsXG4gICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5ncm91cHMgPSBbIGRlZmF1bHRHcm91cCBdO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiggIXRoaXMubGV2ZWxHYXAgKSB0aGlzLmxldmVsR2FwID0gMzU7XG4gICAgdGhpcy5kZWZhdWx0SGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgdGhpcy5hbGwgPSBJc0FycmF5KCB0aGlzLnZhbHVlICkgPyAoIHRoaXMub3B0aW9ucy52YWx1ZXMubGVuZ3RoID09PSAoIDxhbnlbXT50aGlzLnZhbHVlICkubGVuZ3RoICkgOiBmYWxzZTtcblxuICAgIGlmKCAhdGhpcy5wb3NpdGlvbiApIHRoaXMucG9zaXRpb24gPSAnYmVsb3cnO1xuICAgIGlmKCAhdGhpcy5wYXRjaCApIHRoaXMucGF0Y2ggPSB7IGZpZWxkOiAnJywgZHVyYXRpb246IDc1MCwgcGF0aDogJycsIGRpc2FibGVkOiBmYWxzZSB9O1xuICAgIGlmKCB0aGlzLnBhdGNoLmRpc3BsYXlJbmRpY2F0b3IgIT09IGZhbHNlICkgdGhpcy5wYXRjaC5kaXNwbGF5SW5kaWNhdG9yID0gdHJ1ZTtcbiAgICBpZiggdGhpcy5ncm91cHMubGVuZ3RoID09PSAxICkgdGhpcy5jb2xsYXBzZWQgPSBmYWxzZTtcbiAgICBpZiggdGhpcy5ub0luaXRpYWxWYWx1ZSApIHRoaXMudmFsdWUgPSB0aGlzLm11bHRpcGxlID8gW10gOiAnJztcbiAgICBpZiggIXRoaXMuY29udHJvbCApIHRoaXMuc2V0Q29udHJvbCgpO1xuICB9XG5cblxuICBzZXRDb250cm9sKCl7XG4gICAgdGhpcy5jb250cm9sID0gKCB0aGlzLmRpc2FibGVkID8gbmV3IEZvcm1Db250cm9sKCB7XG4gICAgICB2YWx1ZTogdGhpcy52YWx1ZSxcbiAgICAgIGRpc2FibGVkOiB0cnVlXG4gICAgfSApIDogbmV3IEZvcm1Db250cm9sKCB0aGlzLnZhbHVlLCAoIHRoaXMudmFsaWRhdG9ycyA/IHRoaXMudmFsaWRhdG9ycyA6IFtdICkgKSApO1xuICB9XG5cblxuICBwcml2YXRlIHNldERlZmF1bHRWYWx1ZXMoKTogdm9pZHtcbiAgICAvLyB0aGlzLmhlbHBUZXh0ID0gJyc7XG4gICAgdGhpcy5sYWJlbCA9ICcnO1xuICAgIHRoaXMubWVzc2FnZSA9ICcnO1xuICAgIHRoaXMub3B0aW9ucyA9IHsgdmFsdWVzOiBbXSB9O1xuICAgIHRoaXMuZGlzYWJsZWQgPSBmYWxzZTtcbiAgICB0aGlzLnNvcnQgPSBmYWxzZTtcbiAgICAvLyB0aGlzLnNob3dUb29sdGlwID0gZmFsc2U7XG4gICAgLy8gdGhpcy50b29sdGlwID0gJyc7XG4gIH1cblxuXG4gIHByaXZhdGUgZ2V0T3B0aW9uR3JvdXBzKCk6IFNlbGVjdEZpbHRlckdyb3VwSW50ZXJmYWNlW117XG4gICAgdGhpcy5zZWxlY3RlZE9wdGlvbnMgPSBbXTtcblxuICAgIGNvbnN0IGdyb3VwcyA9IHt9O1xuICAgIGNvbnN0IGxpc3QgPSBbXTtcbiAgICBsZXQgZGVmYXVsdEdyb3VwID0gdGhpcy5vcHRpb25zLnZhbHVlc1sgMCBdLmdyb3VwO1xuICAgIHRoaXMub3B0aW9ucy52YWx1ZXMubWFwKCAoIG9wdGlvbiwgaW5kZXggKSA9PiB7XG4gICAgICBpZiggdHlwZW9mIG9wdGlvbi5sZXZlbCA9PT0gJ3VuZGVmaW5lZCcgKSBvcHRpb24ubGV2ZWwgPSAwO1xuICAgICAgb3B0aW9uLmxldmVsID0gdGhpcy5sZXZlbEdhcCAqIG9wdGlvbi5sZXZlbDtcbiAgICAgIGlmKCAhb3B0aW9uLmdyb3VwICkgb3B0aW9uLmdyb3VwID0gZGVmYXVsdEdyb3VwO1xuICAgICAgaWYoIG9wdGlvbi5ncm91cCBpbiBncm91cHMgPT09IGZhbHNlICl7XG4gICAgICAgIGdyb3Vwc1sgb3B0aW9uLmdyb3VwIF0gPSA8U2VsZWN0RmlsdGVyR3JvdXBJbnRlcmZhY2U+IHtcbiAgICAgICAgICBsYWJlbDogb3B0aW9uLmdyb3VwLFxuICAgICAgICAgIGdyb3VwRms6IG9wdGlvbi5ncm91cEZrLFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIHZhbHVlczogW10sXG4gICAgICAgICAgICBmaWx0ZXJlZDogW11cbiAgICAgICAgICB9LFxuICAgICAgICAgIGFsbDogZmFsc2UsXG4gICAgICAgICAgb3BlbjogdHJ1ZSxcbiAgICAgICAgICBpbmRldGVybWluYXRlOiBmYWxzZSxcbiAgICAgICAgfTtcbiAgICAgICAgZGVmYXVsdEdyb3VwID0gb3B0aW9uLmdyb3VwO1xuICAgICAgfVxuICAgICAgaWYoIHRoaXMuYWxsICl7XG4gICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zLnB1c2goIG9wdGlvbi52YWx1ZSApO1xuICAgICAgfWVsc2V7XG4gICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IElzQXJyYXkodGhpcy52YWx1ZSkgPyAoPGFueVtdPnRoaXMudmFsdWUpLmluY2x1ZGVzKCBvcHRpb24udmFsdWUgKTogZmFsc2U7XG4gICAgICAgIGlmKCBvcHRpb24uc2VsZWN0ZWQgKXtcbiAgICAgICAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKCBvcHRpb24udmFsdWUgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZ3JvdXBzWyBvcHRpb24uZ3JvdXAgXS5vcHRpb25zLnZhbHVlcy5wdXNoKCBvcHRpb24gKTtcbiAgICB9ICk7XG4gICAgY29uc3QgY291bnQgPSBPYmplY3Qua2V5cyggZ3JvdXBzICkubGVuZ3RoO1xuICAgIE9iamVjdC5rZXlzKCBncm91cHMgKS5tYXAoICgga2V5ICkgPT4ge1xuICAgICAgY29uc3QgZ3JvdXAgPSBncm91cHNbIGtleSBdO1xuICAgICAgLy8gaWYoSXNBcnJheShncm91cC5vcHRpb25zLnZhbHVlcykpe1xuICAgICAgLy8gICAvLyBUb0RvOjogYWxsb3cgb3JkZXJpbmcgYnkgYSBzb3J0IG9yZGVyIHByb3BlcnR5XG4gICAgICAvLyAgIGdyb3VwLm9wdGlvbnMudmFsdWVzID0gZ3JvdXAub3B0aW9ucy52YWx1ZXMuc29ydChEeW5hbWljU29ydCgnbmFtZScpKTtcbiAgICAgIC8vIH1cbiAgICAgIGlmKCBjb3VudCA+IDEgJiYgdGhpcy5jb2xsYXBzZWQgKSBncm91cC5vcGVuID0gZmFsc2U7XG4gICAgICBsaXN0LnB1c2goIGdyb3Vwc1sga2V5IF0gKTtcbiAgICB9ICk7XG4gICAgcmV0dXJuIGxpc3Q7XG4gIH1cblxuXG4gIHB1YmxpYyByZXNldFNlbGVjdGlvbigpOiB2b2lke1xuICAgIHRoaXMuc2VsZWN0ZWRPcHRpb25zID0gW107XG4gIH1cblxuXG4gIHB1YmxpYyBhZGRTZWxlY3RlZE9wdGlvbiggb3B0aW9uOiBudW1iZXIgKTogdm9pZHtcbiAgICB0aGlzLnNlbGVjdGVkT3B0aW9ucy5wdXNoKCBvcHRpb24gKTtcbiAgfVxufVxuXG4iXX0=