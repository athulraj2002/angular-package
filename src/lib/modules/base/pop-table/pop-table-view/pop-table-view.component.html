<table mat-table  [trackBy]="trackRowByItemId" [dataSource]="config.matData" matSort class="table" full-width>

  <ng-container
    *ngFor="let col of config.columnConfig.visible;"
    matColumnDef="{{col}}"
    [ngSwitch]="config.columnConfig.templates[col].template"
    sticky="{{config.columnConfig.templates[col].sticky === true}}">

    <!-- DEFAULT -->
    <div *ngSwitchDefault></div>

    <!-- STANDARD -->
    <div  *ngSwitchCase="'Standard'">
      <th *ngIf="!config.searchColumns && !config.sort; then HeaderStandard"></th>
      <th *ngIf="config.searchColumns && !config.sort; then HeaderSearch"></th>
      <th *ngIf="!config.searchColumns && config.sort; then HeaderSort"></th>
      <th *ngIf="config.searchColumns && config.sort; then HeaderSortSearch"></th>
      <td
        mat-cell *matCellDef="let row;let index = index;" [ngClass]="{'first-row-no-header': index === 0 && !config.headerDisplay}"
        (click)="( row[col] ? onColumnStandardClick(col, row) : onBubbleEvent('row_clicked', row) )"
        (contextmenu)="( row[col] ? dom.contextMenu.configure(col, row, $event) : onBubbleEvent('row_right_clicked', row) )"
      >{{row[col]}}
      </td>
    </div>

    <!-- STANDARD WITH HELPER TEXT -->
    <div *ngSwitchCase="'StandardHelper'">
      <th *ngIf="!config.searchColumns && !config.sort; then HeaderStandard"></th>
      <th *ngIf="config.searchColumns && !config.sort; then HeaderSearch"></th>
      <th *ngIf="!config.searchColumns && config.sort; then HeaderSort"></th>
      <th *ngIf="config.searchColumns && config.sort; then HeaderSortSearch"></th>
      <td
        (mouseenter)="ui.helperText[ii] = '';"
        (mouseleave)="ui.helperText.splice(ii, 1)"
        matTooltip="{{ui.helperText[ii] ? ui.helperText[ii] : onHelperText(ii, col, row)}}"
        matTooltipPosition="{{config.columnConfig.templates[col].helper.position}}"
        mat-cell *matCellDef="let row; let ii = index" [ngClass]="{'first-row-no-header': ii === 0 && !config.headerDisplay}"
        (click)="( row[col] ? onColumnStandardClick(col, row) : onBubbleEvent('row_clicked', row) )"
        (contextmenu)="( row[col] ? dom.contextMenu.configure(col, row, $event) : onBubbleEvent('row_right_clicked', row) )"
      >{{row[col]}}
      </td>
    </div>


    <!-- ROUTE -->
    <div *ngSwitchCase="'Route'">
      <th *ngIf="!config.searchColumns && !config.sort; then HeaderStandard"></th>
      <th *ngIf="config.searchColumns && !config.sort; then HeaderSearch"></th>
      <th *ngIf="!config.searchColumns && config.sort; then HeaderSort"></th>
      <th *ngIf="config.searchColumns && config.sort; then HeaderSortSearch"></th>
      <td [ngClass]="row[col] ? 'sw-a' : ''"
        mat-cell *matCellDef="let row; let index = index" [ngClass]="{'first-row-no-header': index === 0 && !config.headerDisplay}"
        (click)="( row[col] ? onColumnRouteClick(col, row) : onBubbleEvent('row_clicked', row) )"
        (contextmenu)="( row[col] ? dom.contextMenu.configure(col, row, $event) : onBubbleEvent('row_right_clicked', row) )"
      >{{row[col]}}
      </td>
    </div>


    <!-- ROUTE WITH HELPER TEXT -->
    <div *ngSwitchCase="'RouteHelper'">
      <th *ngIf="!config.searchColumns && !config.sort; then HeaderStandard"></th>
      <th *ngIf="config.searchColumns && !config.sort; then HeaderSearch"></th>
      <th *ngIf="!config.searchColumns && config.sort; then HeaderSort"></th>
      <th *ngIf="config.searchColumns && config.sort; then HeaderSortSearch"></th>
      <td
        [ngClass]="{'sw-a': row[col],  'first-row-no-header': ii === 0 && !config.headerDisplay}"
        (mouseenter)="ui.helperText[ii] = ''"
        (mouseleave)="ui.helperText.splice(ii, 1)"
        matTooltip="{{ ui.helperText[ii] ? ui.helperText[ii] : onHelperText(ii, col, row)}}"
        matTooltipPosition="{{config.columnConfig.templates[col].helper.position}}"
        mat-cell *matCellDef="let row; let ii = index"
        (click)="( row[col] ? onColumnRouteClick(col, row) : onBubbleEvent('row_clicked', row) )"
        (contextmenu)="( row[col] ? dom.contextMenu.configure(col, row, $event) : onBubbleEvent('row_right_clicked', row) )"
      >{{row[col]}}
      </td>
    </div>


    <!-- ROUTE WITH ICON -->
    <div *ngSwitchCase="'RouteIcon'">
      <th mat-header-cell *matHeaderCellDef>{{config.columnConfig.templates[col].display}}</th>
      <td
        class="sw-a site-pointer"
        mat-cell *matCellDef="let row; let index = i" [ngClass]="{'first-row-no-header': index === 0 && !config.headerDisplay}"
        (click)="onColumnRouteClick(col, row)"
        (contextmenu)="( row[col] ? dom.contextMenu.configure(col, row, $event) : onBubbleEvent('row_right_clicked', row) )"
      >
        <div [ngSwitch]="config.columnConfig.templates[col].icon.type">
          <div *ngSwitchCase="'IconImg'">
            <img src="{{config.columnConfig.templates[col].icon.name}}" alt="{{row[col]}}">
          </div>
          <div *ngSwitchCase="'IconMat'">
            <mat-icon class="sw-cursor-pointer">{{config.columnConfig.templates[col].icon.name}}</mat-icon>
          </div>
          <div *ngSwitchCase="'IconPop'">
            <span class="sw-pop-icon">{{config.columnConfig.templates[col].icon.name}}</span>
          </div>
          <div *ngSwitchDefault>{{row[col]}}</div>
        </div>
      </td>
    </div>


    <!-- ROUTE WITH ICON AND HELPER TEXT -->
    <div *ngSwitchCase="'RouteIconHelper'">
      <th mat-header-cell *matHeaderCellDef>{{config.columnConfig.templates[col].display}}</th>
      <td
        class="sw-a site-pointer"
        (mouseenter)="ui.helperText[ii] = '';"
        (mouseleave)="ui.helperText.splice(ii, 1)"
        matTooltip="{{ui.helperText[ii] ? ui.helperText[ii] : onHelperText(ii, col, row)}}"
        matTooltipPosition="{{config.columnConfig.templates[col].helper.position}}"
        mat-cell *matCellDef="let row; let ii = index" [ngClass]="{'first-row-no-header': ii === 0 && !config.headerDisplay}"
        (click)="onColumnRouteClick(col, row)"
        (contextmenu)="( row[col] ? dom.contextMenu.configure(col, row, $event) : onBubbleEvent('row_right_clicked', row) )"
      >
        <div [ngSwitch]="config.columnConfig.templates[col].icon.type">
          <div *ngSwitchCase="'IconImg'">
            <img src="{{config.columnConfig.templates[col].icon.name}}" alt="{{row[col]}}">
          </div>
          <div *ngSwitchCase="'IconMat'">
            <mat-icon class="sw-cursor-pointer">{{config.columnConfig.templates[col].icon.name}}</mat-icon>
          </div>
          <div *ngSwitchCase="'IconPop'">
            <span class="sw-pop-icon">{{config.columnConfig.templates[col].icon.name}}</span>
          </div>
          <div *ngSwitchDefault>{{row[col]}}</div>
        </div>
      </td>
    </div>


    <!-- LINK -->
    <div *ngSwitchCase="'Link'">
      <th *ngIf="!config.searchColumns && !config.sort; then HeaderStandard"></th>
      <th *ngIf="config.searchColumns && !config.sort; then HeaderSearch"></th>
      <th *ngIf="!config.searchColumns && config.sort; then HeaderSort"></th>
      <th *ngIf="config.searchColumns && config.sort; then HeaderSortSearch"></th>
      <td class="site-pointer"
        [ngClass]="row[col] ? 'sw-a' : ''"
        mat-cell *matCellDef="let row; let index = index" [ngClass]="{'first-row-no-header': index === 0 && !config.headerDisplay}"
        (click)="( row[col] ? onColumnLinkClick(col, row) : onBubbleEvent('row_clicked', row) )"
      >{{row[col]}}
      </td>
    </div>

    <!-- LINK WITH HELPER TEXT -->
    <div *ngSwitchCase="'LinkHelper'">
      <th *ngIf="!config.searchColumns && !config.sort; then HeaderStandard"></th>
      <th *ngIf="config.searchColumns && !config.sort; then HeaderSearch"></th>
      <th *ngIf="!config.searchColumns && config.sort; then HeaderSort"></th>
      <th *ngIf="config.searchColumns && config.sort; then HeaderSortSearch"></th>
      <td class="site-pointer"
        [ngClass]="row[col] ? 'sw-a' : ''"
        (mouseenter)="ui.helperText[ii] = '';"
        (mouseleave)="ui.helperText.splice(ii, 1)"
        matTooltip="{{ui.helperText[ii] ? ui.helperText[ii] : onHelperText(ii, col, row)}}"
        matTooltipPosition="{{config.columnConfig.templates[col].helper.position}}"
        mat-cell *matCellDef="let row; let ii = index" [ngClass]="{'first-row-no-header': ii === 0 && !config.headerDisplay}"
        (click)="( row[col] ? onColumnLinkClick(col, row) : onBubbleEvent('row_clicked', row) )"
      >{{row[col]}}
      </td>
    </div>

    <!-- LINK WITH ICON -->
    <div *ngSwitchCase="'LinkIcon'">
      <th mat-header-cell *matHeaderCellDef>{{config.columnConfig.templates[col].display}}</th>
      <td
        class="sw-a site-pointer"
        mat-cell *matCellDef="let row; let index = index" [ngClass]="{'first-row-no-header': index === 0 && !config.headerDisplay}"
        (click)="onColumnLinkClick(col, row)"
      >
        <div [ngSwitch]="config.columnConfig.templates[col].icon.type">
          <div *ngSwitchCase="'IconImg'">
            <img src="{{config.columnConfig.templates[col].icon.name}}" alt="{{row[col]}}">
          </div>
          <div *ngSwitchCase="'IconMat'">
            <mat-icon class="sw-cursor-pointer">{{config.columnConfig.templates[col].icon.name}}</mat-icon>
          </div>
          <div *ngSwitchCase="'IconPop'">
            <span class="sw-pop-icon">{{config.columnConfig.templates[col].icon.name}}</span>
          </div>
          <div *ngSwitchDefault>{{row[col]}}</div>
        </div>
      </td>
    </div>

    <!-- LINK WITH ICON AND HELPER TEXT -->
    <div *ngSwitchCase="'LinkIconHelper'">
      <th mat-header-cell *matHeaderCellDef>{{config.columnConfig.templates[col].display}}</th>
      <td
        class="sw-a site-pointer"
        (mouseenter)="ui.helperText[ii] = '';"
        (mouseleave)="ui.helperText.splice(ii, 1)"
        matTooltip="{{ui.helperText[ii] ? ui.helperText[ii] : onHelperText(ii, col, row)}}"
        matTooltipPosition="{{config.columnConfig.templates[col].helper.position}}"
        mat-cell *matCellDef="let row; let ii = index" [ngClass]="{'first-row-no-header': ii === 0 && !config.headerDisplay}"
        (click)="onColumnLinkClick(col, row)"
      >
        <div [ngSwitch]="config.columnConfig.templates[col].icon.type">
          <div *ngSwitchCase="'IconImg'">
            <img src="{{config.columnConfig.templates[col].icon.name}}" alt="{{row[col]}}">
          </div>
          <div *ngSwitchCase="'IconMat'">
            <mat-icon class="sw-cursor-pointer">{{config.columnConfig.templates[col].icon.name}}</mat-icon>
          </div>
          <div *ngSwitchCase="'IconPop'">
            <span class="sw-pop-icon">{{config.columnConfig.templates[col].icon.name}}</span>
          </div>
          <div *ngSwitchDefault>{{row[col]}}</div>
        </div>
      </td>
    </div>


    <!-- ICON -->
    <div *ngSwitchCase="'Icon'">
      <th mat-header-cell *matHeaderCellDef>{{config.columnConfig.templates[col].display}}</th>
      <td class="site-pointer"
        mat-cell *matCellDef="let row; let index = index" [ngClass]="{'first-row-no-header': index === 0 && !config.headerDisplay}"
        (click)="( row[col] ? onColumnStandardClick(col, row) : onBubbleEvent('row_right_clicked', row) )"
      >
        <div [ngSwitch]="config.columnConfig.templates[col].icon.type">
          <div *ngSwitchCase="'IconImg'">
            <img src="{{config.columnConfig.templates[col].icon.name}}" alt="{{row[col]}}">
          </div>
          <div *ngSwitchCase="'IconMat'">
            <mat-icon class="sw-cursor-pointer">{{config.columnConfig.templates[col].icon.name}}</mat-icon>
          </div>
          <div *ngSwitchCase="'IconPop'">
            <span class="sw-pop-icon">{{config.columnConfig.templates[col].icon.name}}</span>
          </div>
          <div *ngSwitchDefault>{{row[col]}}</div>
        </div>
      </td>
    </div>


    <!-- ICON WITH HELPER TEXT -->
    <div *ngSwitchCase="'IconHelper'">
      <th mat-header-cell *matHeaderCellDef>{{config.columnConfig.templates[col].display}}</th>
      <td class="site-pointer"
        (mouseenter)="ui.helperText[ii] = '';"
        (mouseleave)="ui.helperText.splice(ii, 1)"
        matTooltip="{{ui.helperText[ii] ? ui.helperText[ii] : onHelperText(ii, col, row)}}"
        matTooltipPosition="{{config.columnConfig.templates[col].helper.position}}"
        mat-cell *matCellDef="let row; let ii = index" [ngClass]="{'first-row-no-header': ii === 0 && !config.headerDisplay}"
        (click)="( row[col] ? onColumnStandardClick(col, row) : onBubbleEvent('row_right_clicked', row) )"
      >
        <div [ngSwitch]="config.columnConfig.templates[col].icon.type">
          <div *ngSwitchCase="'IconImg'">
            <img src="{{config.columnConfig.templates[col].icon.name}}" alt="{{row[col]}}">
          </div>
          <div *ngSwitchCase="'IconMat'">
            <mat-icon class="sw-cursor-pointer">{{config.columnConfig.templates[col].icon.name}}</mat-icon>
          </div>
          <div *ngSwitchCase="'IconPop'">
            <span class="sw-pop-icon">{{config.columnConfig.templates[col].icon.name}}</span>
          </div>
          <div *ngSwitchDefault>{{row[col]}}</div>
        </div>
      </td>
    </div>


    <!-- CHECKBOX -->
    <div *ngSwitchCase="'Checkbox'">
      <th mat-header-cell *matHeaderCellDef class="checkbox-column">
        <mat-checkbox [ngClass]="{'column-search-checkbox': config?.searchColumns}" #checkbox color="accent" (change)="$event ? onMasterRowToggleClick() : null"
                      [checked]="config.selection?.hasValue() && isAllRowsSelected()"
                      [indeterminate]="config.selection?.hasValue() && !isAllRowsSelected()">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let row; let i = index" class="checkbox-column" [ngClass]="{'first-row-no-header': i === 0 && !config.headerDisplay}">
        <mat-checkbox color="accent" (click)="$event.stopPropagation()"
                      (change)="($event ? config.selection?.toggle(row) : null); onBubbleEvent(($event.checked ? 'row_selected' : 'row_unselected'), row)"
                      [checked]="config.selection?.isSelected(row)">
        </mat-checkbox>
      </td>
    </div>

    <!-- HEADER TEMPLATES -->
    <ng-template #HeaderStandard>
      <th mat-header-cell *matHeaderCellDef>{{config.columnConfig.templates[col].display}}</th>
    </ng-template>

    <ng-template #HeaderSort>
      <th class="sortable-header" mat-header-cell *matHeaderCellDef (click)="sort(config.columnConfig?.templates[col].name)">


        <div class="column-header-sort">
          <div>
            {{config.columnConfig.templates[col].display}}
          </div>

          <div >
            <mat-icon class="sort-top-searchable"
                      [ngClass]="{visible: tableSort.active === config.columnConfig?.templates[col].name, hidden: tableSort.active !== config.columnConfig?.templates[col].name}"

                      >{{sortDisplay(config.columnConfig?.templates[col].name)}}</mat-icon>

<!--            <mat-icon class="sort-top-searchable"-->
<!--                      [ngClass]="{'sort-selected': tableSort.active === config.columnConfig?.templates[col].name && tableSort.direction === 'asc'}"-->
<!--                      (click)="sort(config.columnConfig?.templates[col].name, 'asc')">arrow_drop_up</mat-icon>-->
<!--            <mat-icon class="sort-bottom-searchable"-->
<!--                      [ngClass]="{'sort-selected': tableSort.active === config.columnConfig?.templates[col].name && tableSort.direction === 'desc'}"-->
<!--                      (click)="sort(config.columnConfig?.templates[col].name, 'desc')">arrow_drop_down</mat-icon>-->
          </div>
        </div>
      </th>
    </ng-template>

    <ng-template #HeaderSearch>
      <th  mat-header-cell *matHeaderCellDef >
        <div style="padding-top: var(--gap-m)">{{config.columnConfig?.templates[col].display}}</div>

        <div class="column-sort">
          <mat-form-field appearance="outline" class="sw-search" style="padding-bottom: var(--gap-s)">
            <!--          <mat-label><mat-icon>search</mat-icon> </mat-label>-->
            <!--          <mat-label>{{config.columnConfig.templates[col].display}}</mat-label>-->
            <!--          <a matPrefix><mat-icon>search</mat-icon></a>-->
            <input matInput (keyup)="onApplySearchValue($event.target.value, col)" placeholder="Search">
          </mat-form-field>
        </div>

      </th>
    </ng-template>

    <ng-template #HeaderSortSearch>
      <th class="sortable-header" mat-header-cell *matHeaderCellDef (click)="sort(config.columnConfig?.templates[col].name)">
        <div class="column-header-sort" style="padding-top: var(--gap-m)">
          <div>
            {{config.columnConfig?.templates[col].display}}
          </div>

          <div >
            <mat-icon class="sort-top-searchable"
                      [ngClass]="{visible: tableSort.active === config.columnConfig?.templates[col].name, hidden: tableSort.active !== config.columnConfig?.templates[col].name}"

                      (click)="sort(config.columnConfig?.templates[col].name)">{{sortDisplay(config.columnConfig?.templates[col].name)}}</mat-icon>
<!--            <mat-icon class="sort-top-searchable"-->
<!--                      [ngClass]="{'sort-selected': tableSort.active === config.columnConfig.templates[col].name && tableSort.direction === 'asc'}"-->
<!--                      (click)="sort(config.columnConfig?.templates[col].name, 'asc')">arrow_drop_up</mat-icon>-->
<!--            <mat-icon class="sort-bottom-searchable"-->
<!--                      [ngClass]="{'sort-selected': tableSort.active === config.columnConfig.templates[col].name && tableSort.direction === 'desc'}"-->
<!--                      (click)="sort(config.columnConfig?.templates[col].name, 'desc')">arrow_drop_down</mat-icon>-->
          </div>
        </div>

        <div class="column-sort" >
          <mat-form-field appearance="outline" class="sw-search" style="padding-bottom: var(--gap-s)">
            <!--          <mat-label><mat-icon>search</mat-icon> </mat-label>-->
            <!--          <mat-label>{{config.columnConfig.templates[col].display}}</mat-label>-->
            <!--          <a matPrefix><mat-icon>search</mat-icon></a>-->
            <input matInput (keyup)="onApplySearchValue($event.target.value, col)" placeholder="Search">
          </mat-form-field>
        </div>
      </th>
    </ng-template>

  </ng-container>

  <tr [ngClass]="{'sw-hidden': !config.headerDisplay}" mat-header-row
      *matHeaderRowDef="config.columnConfig?.visible; sticky:config.headerSticky"></tr>
  <tr mat-row *matRowDef="let row; columns: config.columnConfig?.visible;"></tr>
  <tr class="mat-row" *matNoDataRow>
    <td class="mat-cell" colspan="12">No Data Found</td>
  </tr>
</table>
<lib-pop-context-menu *ngIf="dom.contextMenu?.config" [config]="dom.contextMenu.config"></lib-pop-context-menu>
