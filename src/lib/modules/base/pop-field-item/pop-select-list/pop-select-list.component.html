<div class="pop-select-list-container import-field-item-container">
  <div class="pop-select-list-label" *ngIf="config.label">
    {{config.label}}
  </div>
  <div *ngIf="config.helpText && !config.message && ( !config.patch || !config.patch.running )"
       class="sw-pop-icon sw-pointer pop-select-list-helper-icon"
       (mouseenter)="dom.state.helper = true"
       (mouseleave)="dom.state.helper = false"
       matTooltip="{{config.helpText}}"
       matTooltipPosition="above">X
  </div>
  <div class="pop-select-list-feedback">
    <div *ngIf="config.message"
         class="pop-select-error-icon"
         matTooltipPosition="left"
         [matTooltip]=config.message>
      <mat-icon color="warn">info</mat-icon>
    </div>
  </div>
  <div class="pop-select-list-items" #list>

    <div class="import-flex-row pop-select-list-overlay pop-select-list-option-header-open" *ngIf="ui.all.overlay">
      <lib-pop-switch [config]="ui.all.overlay"></lib-pop-switch>
    </div>

    <div class="pop-select-search-header">
      <mat-checkbox
        *ngIf="config.multiple && config.allowAll && config.checkboxPosition === 'before'"
        class="pop-select-list-checkbox-before"
        [ngClass]="{'sw-hidden': dom.state.allOverlayEnabled}"
        [(ngModel)]="config.all"
        [disabled]="config.disabled"
        [color]="'primary'"
        matTooltip="Toggle All"
        matTooltipPosition="above"
        (change)="onAllChange($event.checked);">
      </mat-checkbox>

      <mat-form-field *ngIf="config.filter && ui.search.config" appearance="none" floatLabel="never" class="sw-search"
                      [ngClass]="{'sw-hidden': dom.state.allOverlayEnabled}">
        <a matPrefix>
          <mat-icon>search</mat-icon>
        </a>
        <input matInput placeholder="Search"
               #search
               type="text"
               [formControl]="ui.search.config.control">
        <mat-icon *ngIf="ui.search.config.control.value" class="pop-select-list-clear sw-pointer" matSuffix
                  (click)="onClearSearch();">
          close
        </mat-icon>
      </mat-form-field>

      <mat-checkbox
        *ngIf="config.multiple && config.allowAll && config.checkboxPosition === 'after'"
        class="pop-select-list-checkbox-after"
        [ngClass]="{'sw-hidden': dom.state.allOverlayEnabled}"
        [(ngModel)]="config.all"
        [color]="'primary'"
        [disabled]="config.disabled"
        matTooltip="Toggle All"
        matTooltipPosition="above"
        (change)="onAllChange($event.checked);">
      </mat-checkbox>
      <div *ngIf="dom.state.allOverlayEnabled && config.allOverlayMessage" class="pop-select-list-overlay-message"
           [innerHTML]=config.allOverlayMessage></div>
    </div>


    <mat-selection-list [style.minHeight.px]=config.minHeight [style.maxHeight.px]=config.height #selectionList [multiple]=config.multiple>
      <div *ngFor="let group of config.groups" [ngClass]="{'sw-hidden': dom.state.allOverlayEnabled}">
        <div class="pop-select-list-option-header" [ngClass]="{'pop-select-list-option-header-open': group.open, 'pop-select-list-option-header-before': config.checkboxPosition === 'before', 'pop-select-list-option-header-after': config.checkboxPosition !== 'before'}" *ngIf="group.label && group.visible">
          <mat-checkbox
            *ngIf="config.multiple && config.checkboxPosition === 'before'"
            [ngClass]="{'sw-disabled': !config.allowGroupAll}"
            [(ngModel)]="group.all"
            [color]="'primary'"
            [disabled]="config.disabled"
            [indeterminate]=group.indeterminate
            matTooltip="Toggle Group"
            matTooltipPosition="above"
            (change)="onGroupChange($event.checked, group);">
          </mat-checkbox>
          <div class="pop-select-list-header-label" (click)="onToggleGroup(group);">{{group.label}}
            ({{group.options.values.length}})
          </div>
          <mat-checkbox
            *ngIf="config.multiple && config.checkboxPosition === 'after'"
            [ngClass]="{'sw-disabled': !config.allowGroupAll}"
            [(ngModel)]="group.all"
            [color]="'primary'"
            [disabled]="config.disabled"
            [indeterminate]=group.indeterminate
            matTooltip="Toggle Group"
            matTooltipPosition="above"
            (change)="onGroupChange($event.checked, group);">
          </mat-checkbox>
        </div>

        <mat-list-option
          *ngFor="let option of group.options.values"
          [checkboxPosition]=config.checkboxPosition
          [disabled]="config.disabled"
          class="pop-select-list-option"
          [ngClass]="{'pop-select-list-active': isOptionActive(option), 'sw-disabled': isOptionDisabled(option),'sw-hidden': isOptionHidden(group, option), 'pop-select-list-checkbox-before': config.checkboxPosition === 'before', 'pop-select-list-checkbox-after': config.checkboxPosition === 'after'}"
          [style.paddingLeft]="option.indentation+'px'"
          [selected]=isOptionSelected(option)
          (click)="onOptionChange($event, option, group);"
          [value]="option.value">
          {{option.name}}
          <div *ngIf="config.multiple && config.mode" class="pop-select-list-mode-toggle"
               (click)="$event.stopPropagation()">
            <mat-button-toggle-group [(ngModel)]="option.mode" (ngModelChange)="onOptionModeChange($event, option)"
                                     name="model" aria-label="Mode">
              <mat-button-toggle *ngFor="let mode of config.mode"
                                 value="{{mode.value}}">{{mode.name}}</mat-button-toggle>
            </mat-button-toggle-group>
          </div>
        </mat-list-option>

      </div>
      <lib-pop-field-item-loader
        [show]="config.patch.displayIndicator && config.patch.running"></lib-pop-field-item-loader>
    </mat-selection-list>
  </div>
</div>
